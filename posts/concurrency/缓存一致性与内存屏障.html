<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-beta.49" />
    <meta name="theme" content="VuePress Theme Hope" />
    <meta property="og:url" content="https://www.chanmufeng.com/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html"><meta property="og:site_name" content="è‰æ²é£"><meta property="og:title" content="ç¼“å­˜ä¸€è‡´æ€§ä¸å†…å­˜å±éšœ"><meta property="og:description" content="æˆ‘èŠ±äº†ä¸¤ä¸ªæœˆæ•´ç†çš„ä¸€ç¯‡æ–‡ç« ï¼Œæ–‡ç« è®²è§£äº†é«˜é€Ÿç¼“å­˜ã€ç¼“å­˜ä¸€è‡´æ€§ã€ç¼“å­˜é”ï¼Œæœ€åå¼•å…¥å†…å­˜å±éšœã€‚æ²¡æœ‰é˜…è¯»é—¨æ§›ï¼Œåƒè¯»å°è¯´ä¸€æ ·å­¦æŠ€æœ¯ã€‚"><meta property="og:type" content="article"><meta property="og:updated_time" content="2022-09-27T06:43:18.000Z"><meta property="og:locale" content="zh-CN"><meta property="article:tag" content="ç¼“å­˜ä¸€è‡´æ€§"><meta property="article:tag" content="å†…å­˜å±éšœ"><meta property="article:tag" content="CPU"><meta property="article:published_time" content="2022-07-27T00:00:00.000Z"><meta property="article:modified_time" content="2022-09-27T06:43:18.000Z"><script>
                var _hmt = _hmt || [];
                (function() {
                  var hm = document.createElement("script");
                  hm.src = "https://hm.baidu.com/hm.js?dfa689801ccd10bd283b50ea146430f3";
                  var s = document.getElementsByTagName("script")[0]; 
                  s.parentNode.insertBefore(hm, s);
                })();
            </script><title>ç¼“å­˜ä¸€è‡´æ€§ä¸å†…å­˜å±éšœ | è‰æ²é£</title><meta name="description" content="æˆ‘èŠ±äº†ä¸¤ä¸ªæœˆæ•´ç†çš„ä¸€ç¯‡æ–‡ç« ï¼Œæ–‡ç« è®²è§£äº†é«˜é€Ÿç¼“å­˜ã€ç¼“å­˜ä¸€è‡´æ€§ã€ç¼“å­˜é”ï¼Œæœ€åå¼•å…¥å†…å­˜å±éšœã€‚æ²¡æœ‰é˜…è¯»é—¨æ§›ï¼Œåƒè¯»å°è¯´ä¸€æ ·å­¦æŠ€æœ¯ã€‚">
    <style>
      :root {
        --bg-color: #fff;
      }

      html[data-theme="dark"] {
        --bg-color: #1d2025;
      }

      html,
      body {
        background-color: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.querySelector("html").setAttribute("data-theme", "dark");
      }
    </script>
    <link rel="stylesheet" href="/assets/style.305841ad.css">
    <link rel="modulepreload" href="/assets/app.e63a78e2.js"><link rel="modulepreload" href="/assets/ç¼“å­˜ä¸€è‡´æ€§ä¸å†…å­˜å±éšœ.html.f9630e62.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper.21dcd24c.js"><link rel="modulepreload" href="/assets/ç¼“å­˜ä¸€è‡´æ€§ä¸å†…å­˜å±éšœ.html.51552874.js"><link rel="prefetch" href="/assets/index.html.f40aab20.js"><link rel="prefetch" href="/assets/home.html.4311fb4f.js"><link rel="prefetch" href="/assets/update.html.cf0bfa19.js"><link rel="prefetch" href="/assets/index.html.bc679553.js"><link rel="prefetch" href="/assets/index.html.42b16337.js"><link rel="prefetch" href="/assets/disable.html.a298796c.js"><link rel="prefetch" href="/assets/encrypt.html.04234872.js"><link rel="prefetch" href="/assets/markdown.html.c40cf8e1.js"><link rel="prefetch" href="/assets/JVMåˆ°åº•è¯¥å­¦ä¹ äº›ä»€ä¹ˆ.html.37a1cd31.js"><link rel="prefetch" href="/assets/index.html.bdb8aaf2.js"><link rel="prefetch" href="/assets/æˆ‘æ˜¯ä¸€ä¸ªåƒåœ¾.html.396cd500.js"><link rel="prefetch" href="/assets/CPUæµæ°´çº¿ä¸æŒ‡ä»¤é‡æ’åº.html.da7853a1.js"><link rel="prefetch" href="/assets/index.html.9cfc822d.js"><link rel="prefetch" href="/assets/ç”¨ã€Œé—ªç”µä¾ ã€è§£é‡Šä¸€ä¸‹è¿›ç¨‹å’Œçº¿ç¨‹.html.9c93b056.js"><link rel="prefetch" href="/assets/6ç§socketæ•°æ®ç»“æ„.html.a32c2f08.js"><link rel="prefetch" href="/assets/Datagram-Sockets.html.1cf61bae.js"><link rel="prefetch" href="/assets/IP.html.e2261b17.js"><link rel="prefetch" href="/assets/IPv4-IPv6.html.5d54177a.js"><link rel="prefetch" href="/assets/IPä¸äºŒè¿›åˆ¶è½¬æ¢.html.372ae625.js"><link rel="prefetch" href="/assets/index.html.05732729.js"><link rel="prefetch" href="/assets/accept.html.b927effc.js"><link rel="prefetch" href="/assets/bind.html.df85cbfd.js"><link rel="prefetch" href="/assets/blocking.html.4d881635.js"><link rel="prefetch" href="/assets/broadcast-packets.html.ba9a114f.js"><link rel="prefetch" href="/assets/client-server.html.13e88bfc.js"><link rel="prefetch" href="/assets/close-shutdown.html.4bf70c89.js"><link rel="prefetch" href="/assets/connect.html.d33da992.js"><link rel="prefetch" href="/assets/getaddrinfo.html.799dc1fa.js"><link rel="prefetch" href="/assets/gethostname.html.e927427f.js"><link rel="prefetch" href="/assets/getpeername.html.ec75ccd0.js"><link rel="prefetch" href="/assets/listen.html.6e31d10d.js"><link rel="prefetch" href="/assets/network-programming.html.287d3b4f.js"><link rel="prefetch" href="/assets/poll.html.7f3e913d.js"><link rel="prefetch" href="/assets/send-recv.html.4c0bca19.js"><link rel="prefetch" href="/assets/sendto-recvfrom.html.68ba7ae7.js"><link rel="prefetch" href="/assets/slightly-advanced-tech.html.5d4b31cb.js"><link rel="prefetch" href="/assets/socket.html.c7c684e6.js"><link rel="prefetch" href="/assets/socketç¼–ç¨‹ç›¸å…³å‡½æ•°.html.a9f6084a.js"><link rel="prefetch" href="/assets/stream-client-sample.html.5f2dafdf.js"><link rel="prefetch" href="/assets/stream-server-sample.html.19ea75cb.js"><link rel="prefetch" href="/assets/ä¸¤ç§Internet-Socket.html.034cc342.js"><link rel="prefetch" href="/assets/ä»€ä¹ˆæ˜¯socket.html.cad0e608.js"><link rel="prefetch" href="/assets/ä»IPv4è¿ç§»åˆ°IPv6.html.7bc58e63.js"><link rel="prefetch" href="/assets/å­—èŠ‚åº.html.d1cc9264.js"><link rel="prefetch" href="/assets/æ¼«è°ˆç½‘ç»œ.html.f4ee65c5.js"><link rel="prefetch" href="/assets/index.html.0a6236b7.js"><link rel="prefetch" href="/assets/ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦.html.804cd066.js"><link rel="prefetch" href="/assets/index.html.1f5ae493.js"><link rel="prefetch" href="/assets/åŠ¨æ€ä»£ç†æ¨¡å¼.html.90a17679.js"><link rel="prefetch" href="/assets/å•ä¾‹æ¨¡å¼.html.c3742e12.js"><link rel="prefetch" href="/assets/å·¥å‚æ¨¡å¼.html.f8c7f9d6.js"><link rel="prefetch" href="/assets/é™æ€ä»£ç†æ¨¡å¼.html.7bbcf6f5.js"><link rel="prefetch" href="/assets/ä¾èµ–å€’ç½®åŸåˆ™.html.56bde280.js"><link rel="prefetch" href="/assets/å¼€é—­åŸåˆ™.html.d45ce1b8.js"><link rel="prefetch" href="/assets/Googleæœç´¢ä¸ºä»€ä¹ˆä¸èƒ½æ— é™åˆ†é¡µï¼Ÿ.html.5b88d232.js"><link rel="prefetch" href="/assets/index.html.abd3d401.js"><link rel="prefetch" href="/assets/m1èŠ¯ç‰‡ç”µè„‘å®‰è£…cerebro.html.0120f768.js"><link rel="prefetch" href="/assets/MySQLä¸Redisçš„æ•°æ®ä¸€è‡´æ€§.html.5ba6736f.js"><link rel="prefetch" href="/assets/MySQLä¼˜åŒ–çš„5ä¸ªç»´åº¦.html.4362df81.js"><link rel="prefetch" href="/assets/MySQLç´¢å¼•çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿.html.d51dd9cb.js"><link rel="prefetch" href="/assets/index.html.c8eb6a41.js"><link rel="prefetch" href="/assets/ä¸€æ¡SELECTè¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„.html.2ace0b89.js"><link rel="prefetch" href="/assets/ä¸€æ¡Updateè¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„.html.8736dea8.js"><link rel="prefetch" href="/assets/ä¸ºä»€ä¹ˆMySQLçš„ä¸»é”®æŸ¥è¯¢è¿™ä¹ˆå¿«.html.69305ec3.js"><link rel="prefetch" href="/assets/ä¸ºä»€ä¹ˆä¸å»ºè®®ä½ ä½¿ç”¨SELECT_.html.ee5e1bb5.js"><link rel="prefetch" href="/assets/äº‹åŠ¡çš„éš”ç¦»æ€§ä¸MVCC.html.a4ad4ac5.js"><link rel="prefetch" href="/assets/ä»æ ¹å„¿ä¸Šç†è§£ç´¢å¼•.html.c7e89f33.js"><link rel="prefetch" href="/assets/index.html.9d93e6d0.js"><link rel="prefetch" href="/assets/RedisæŒä¹…åŒ–â€”â€”AOF.html.3ef66ec5.js"><link rel="prefetch" href="/assets/RedisæŒä¹…åŒ–â€”â€”RDB.html.956f2216.js"><link rel="prefetch" href="/assets/é¸¡è‚‹çš„Redisäº‹åŠ¡.html.bf1172f2.js"><link rel="prefetch" href="/assets/index.html.ccdcd4de.js"><link rel="prefetch" href="/assets/ä»0åˆ°1ç¼–å†™ä¸€æ¬¾æ’ä»¶.html.5f51ccf3.js"><link rel="prefetch" href="/assets/index.html.530ae07a.js"><link rel="prefetch" href="/assets/å¦‚ä½•åŒæ­¥é…ç½®.html.21989554.js"><link rel="prefetch" href="/assets/404.html.4285bac5.js"><link rel="prefetch" href="/assets/index.html.6717b2b6.js"><link rel="prefetch" href="/assets/index.html.5eae9e3f.js"><link rel="prefetch" href="/assets/index.html.85231e1c.js"><link rel="prefetch" href="/assets/index.html.07ef0efd.js"><link rel="prefetch" href="/assets/index.html.e5d6f701.js"><link rel="prefetch" href="/assets/index.html.accaa64c.js"><link rel="prefetch" href="/assets/index.html.9a9f30d6.js"><link rel="prefetch" href="/assets/index.html.68e6d714.js"><link rel="prefetch" href="/assets/index.html.b032f382.js"><link rel="prefetch" href="/assets/index.html.bc540566.js"><link rel="prefetch" href="/assets/index.html.4fa328ce.js"><link rel="prefetch" href="/assets/index.html.2c9f8626.js"><link rel="prefetch" href="/assets/index.html.6c184523.js"><link rel="prefetch" href="/assets/index.html.2309c271.js"><link rel="prefetch" href="/assets/index.html.94d1334e.js"><link rel="prefetch" href="/assets/index.html.3e9b5a53.js"><link rel="prefetch" href="/assets/index.html.da976a01.js"><link rel="prefetch" href="/assets/index.html.843e0dc5.js"><link rel="prefetch" href="/assets/index.html.e6adfc22.js"><link rel="prefetch" href="/assets/index.html.a46272a6.js"><link rel="prefetch" href="/assets/index.html.e68eec84.js"><link rel="prefetch" href="/assets/index.html.c3c92e66.js"><link rel="prefetch" href="/assets/index.html.a1ffa21c.js"><link rel="prefetch" href="/assets/index.html.5c810edd.js"><link rel="prefetch" href="/assets/index.html.7b661157.js"><link rel="prefetch" href="/assets/index.html.a61ab275.js"><link rel="prefetch" href="/assets/index.html.cd04393b.js"><link rel="prefetch" href="/assets/index.html.6ea94130.js"><link rel="prefetch" href="/assets/index.html.938c47df.js"><link rel="prefetch" href="/assets/index.html.b6e53603.js"><link rel="prefetch" href="/assets/index.html.abfe5d6e.js"><link rel="prefetch" href="/assets/index.html.799762a8.js"><link rel="prefetch" href="/assets/index.html.6a1f2c2a.js"><link rel="prefetch" href="/assets/index.html.91d708f1.js"><link rel="prefetch" href="/assets/index.html.2b208795.js"><link rel="prefetch" href="/assets/index.html.970ad9a6.js"><link rel="prefetch" href="/assets/index.html.18750c91.js"><link rel="prefetch" href="/assets/index.html.5832ab43.js"><link rel="prefetch" href="/assets/index.html.46963a2e.js"><link rel="prefetch" href="/assets/index.html.d8d0f261.js"><link rel="prefetch" href="/assets/index.html.656424fd.js"><link rel="prefetch" href="/assets/index.html.740f6c3e.js"><link rel="prefetch" href="/assets/index.html.75361b30.js"><link rel="prefetch" href="/assets/index.html.77d7aba9.js"><link rel="prefetch" href="/assets/index.html.c6475c4b.js"><link rel="prefetch" href="/assets/index.html.4f4df111.js"><link rel="prefetch" href="/assets/index.html.2ef7b821.js"><link rel="prefetch" href="/assets/index.html.0dc0a64e.js"><link rel="prefetch" href="/assets/index.html.a8e5dab4.js"><link rel="prefetch" href="/assets/index.html.8dbe4bd2.js"><link rel="prefetch" href="/assets/index.html.72d090a7.js"><link rel="prefetch" href="/assets/index.html.f0f01938.js"><link rel="prefetch" href="/assets/index.html.899ba14c.js"><link rel="prefetch" href="/assets/index.html.1aac5a85.js"><link rel="prefetch" href="/assets/index.html.79aed47e.js"><link rel="prefetch" href="/assets/index.html.d40b22a3.js"><link rel="prefetch" href="/assets/index.html.50661535.js"><link rel="prefetch" href="/assets/index.html.47d81d31.js"><link rel="prefetch" href="/assets/index.html.3bf9cde9.js"><link rel="prefetch" href="/assets/index.html.9ff42a2f.js"><link rel="prefetch" href="/assets/home.html.f6b6e747.js"><link rel="prefetch" href="/assets/update.html.b875aa03.js"><link rel="prefetch" href="/assets/index.html.50c30d26.js"><link rel="prefetch" href="/assets/index.html.044544a9.js"><link rel="prefetch" href="/assets/disable.html.17c71059.js"><link rel="prefetch" href="/assets/encrypt.html.8a63629a.js"><link rel="prefetch" href="/assets/markdown.html.a6b30ed4.js"><link rel="prefetch" href="/assets/JVMåˆ°åº•è¯¥å­¦ä¹ äº›ä»€ä¹ˆ.html.d82e82f3.js"><link rel="prefetch" href="/assets/index.html.938d3cd5.js"><link rel="prefetch" href="/assets/æˆ‘æ˜¯ä¸€ä¸ªåƒåœ¾.html.15bfac9c.js"><link rel="prefetch" href="/assets/CPUæµæ°´çº¿ä¸æŒ‡ä»¤é‡æ’åº.html.77f8ae0d.js"><link rel="prefetch" href="/assets/index.html.d1e19348.js"><link rel="prefetch" href="/assets/ç”¨ã€Œé—ªç”µä¾ ã€è§£é‡Šä¸€ä¸‹è¿›ç¨‹å’Œçº¿ç¨‹.html.2349f93b.js"><link rel="prefetch" href="/assets/6ç§socketæ•°æ®ç»“æ„.html.f77dd09e.js"><link rel="prefetch" href="/assets/Datagram-Sockets.html.bac61787.js"><link rel="prefetch" href="/assets/IP.html.139e4c33.js"><link rel="prefetch" href="/assets/IPv4-IPv6.html.bcf3b8aa.js"><link rel="prefetch" href="/assets/IPä¸äºŒè¿›åˆ¶è½¬æ¢.html.18a7a33a.js"><link rel="prefetch" href="/assets/index.html.9db4409c.js"><link rel="prefetch" href="/assets/accept.html.462eda52.js"><link rel="prefetch" href="/assets/bind.html.4d2b6729.js"><link rel="prefetch" href="/assets/blocking.html.fa3d208e.js"><link rel="prefetch" href="/assets/broadcast-packets.html.fdec827d.js"><link rel="prefetch" href="/assets/client-server.html.551d5c80.js"><link rel="prefetch" href="/assets/close-shutdown.html.dadfbb13.js"><link rel="prefetch" href="/assets/connect.html.e9c0a33d.js"><link rel="prefetch" href="/assets/getaddrinfo.html.e4a62679.js"><link rel="prefetch" href="/assets/gethostname.html.f9d207fe.js"><link rel="prefetch" href="/assets/getpeername.html.a40ae158.js"><link rel="prefetch" href="/assets/listen.html.a4e55c2c.js"><link rel="prefetch" href="/assets/network-programming.html.f246a51d.js"><link rel="prefetch" href="/assets/poll.html.a2f0c305.js"><link rel="prefetch" href="/assets/send-recv.html.46408249.js"><link rel="prefetch" href="/assets/sendto-recvfrom.html.8add124e.js"><link rel="prefetch" href="/assets/slightly-advanced-tech.html.0fae7705.js"><link rel="prefetch" href="/assets/socket.html.358ee8c6.js"><link rel="prefetch" href="/assets/socketç¼–ç¨‹ç›¸å…³å‡½æ•°.html.15024d6e.js"><link rel="prefetch" href="/assets/stream-client-sample.html.243eba46.js"><link rel="prefetch" href="/assets/stream-server-sample.html.8a9bd4b4.js"><link rel="prefetch" href="/assets/ä¸¤ç§Internet-Socket.html.1f361eca.js"><link rel="prefetch" href="/assets/ä»€ä¹ˆæ˜¯socket.html.5ca1f3bf.js"><link rel="prefetch" href="/assets/ä»IPv4è¿ç§»åˆ°IPv6.html.37f6826b.js"><link rel="prefetch" href="/assets/å­—èŠ‚åº.html.bde1a38d.js"><link rel="prefetch" href="/assets/æ¼«è°ˆç½‘ç»œ.html.b6fd2a5f.js"><link rel="prefetch" href="/assets/index.html.c5e674a8.js"><link rel="prefetch" href="/assets/ä»€ä¹ˆæ˜¯æ–‡ä»¶æè¿°ç¬¦.html.336b6d36.js"><link rel="prefetch" href="/assets/index.html.005a2ab7.js"><link rel="prefetch" href="/assets/åŠ¨æ€ä»£ç†æ¨¡å¼.html.a1adbaff.js"><link rel="prefetch" href="/assets/å•ä¾‹æ¨¡å¼.html.1bef7cdd.js"><link rel="prefetch" href="/assets/å·¥å‚æ¨¡å¼.html.79747f29.js"><link rel="prefetch" href="/assets/é™æ€ä»£ç†æ¨¡å¼.html.16750975.js"><link rel="prefetch" href="/assets/ä¾èµ–å€’ç½®åŸåˆ™.html.7a89b918.js"><link rel="prefetch" href="/assets/å¼€é—­åŸåˆ™.html.26e04431.js"><link rel="prefetch" href="/assets/Googleæœç´¢ä¸ºä»€ä¹ˆä¸èƒ½æ— é™åˆ†é¡µï¼Ÿ.html.5970af3a.js"><link rel="prefetch" href="/assets/index.html.56ae1508.js"><link rel="prefetch" href="/assets/m1èŠ¯ç‰‡ç”µè„‘å®‰è£…cerebro.html.a80ba58f.js"><link rel="prefetch" href="/assets/MySQLä¸Redisçš„æ•°æ®ä¸€è‡´æ€§.html.69f85dc9.js"><link rel="prefetch" href="/assets/MySQLä¼˜åŒ–çš„5ä¸ªç»´åº¦.html.11d86987.js"><link rel="prefetch" href="/assets/MySQLç´¢å¼•çš„æ­£ç¡®ä½¿ç”¨å§¿åŠ¿.html.d32d91b6.js"><link rel="prefetch" href="/assets/index.html.9788a2ee.js"><link rel="prefetch" href="/assets/ä¸€æ¡SELECTè¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„.html.4787d2ca.js"><link rel="prefetch" href="/assets/ä¸€æ¡Updateè¯­å¥æ˜¯å¦‚ä½•æ‰§è¡Œçš„.html.794cb050.js"><link rel="prefetch" href="/assets/ä¸ºä»€ä¹ˆMySQLçš„ä¸»é”®æŸ¥è¯¢è¿™ä¹ˆå¿«.html.ae135062.js"><link rel="prefetch" href="/assets/ä¸ºä»€ä¹ˆä¸å»ºè®®ä½ ä½¿ç”¨SELECT_.html.33654151.js"><link rel="prefetch" href="/assets/äº‹åŠ¡çš„éš”ç¦»æ€§ä¸MVCC.html.0f18da5f.js"><link rel="prefetch" href="/assets/ä»æ ¹å„¿ä¸Šç†è§£ç´¢å¼•.html.db4782b7.js"><link rel="prefetch" href="/assets/index.html.f7a9ee3e.js"><link rel="prefetch" href="/assets/RedisæŒä¹…åŒ–â€”â€”AOF.html.548300c5.js"><link rel="prefetch" href="/assets/RedisæŒä¹…åŒ–â€”â€”RDB.html.e5be9473.js"><link rel="prefetch" href="/assets/é¸¡è‚‹çš„Redisäº‹åŠ¡.html.53cdfc95.js"><link rel="prefetch" href="/assets/index.html.031cd8f4.js"><link rel="prefetch" href="/assets/ä»0åˆ°1ç¼–å†™ä¸€æ¬¾æ’ä»¶.html.58e4485f.js"><link rel="prefetch" href="/assets/index.html.960e7d47.js"><link rel="prefetch" href="/assets/å¦‚ä½•åŒæ­¥é…ç½®.html.062dea59.js"><link rel="prefetch" href="/assets/404.html.4ffecf60.js"><link rel="prefetch" href="/assets/index.html.653cfb31.js"><link rel="prefetch" href="/assets/index.html.c97b0205.js"><link rel="prefetch" href="/assets/index.html.60dd4947.js"><link rel="prefetch" href="/assets/index.html.df082618.js"><link rel="prefetch" href="/assets/index.html.eb7ae1c3.js"><link rel="prefetch" href="/assets/index.html.60e98100.js"><link rel="prefetch" href="/assets/index.html.d448b6cc.js"><link rel="prefetch" href="/assets/index.html.cbcab33c.js"><link rel="prefetch" href="/assets/index.html.fab888a8.js"><link rel="prefetch" href="/assets/index.html.abbd1e9b.js"><link rel="prefetch" href="/assets/index.html.58449fe3.js"><link rel="prefetch" href="/assets/index.html.7c3b38ae.js"><link rel="prefetch" href="/assets/index.html.d79bb2d5.js"><link rel="prefetch" href="/assets/index.html.4a9d6059.js"><link rel="prefetch" href="/assets/index.html.71b73a87.js"><link rel="prefetch" href="/assets/index.html.a4d30e9a.js"><link rel="prefetch" href="/assets/index.html.ea52254a.js"><link rel="prefetch" href="/assets/index.html.982cc4e8.js"><link rel="prefetch" href="/assets/index.html.903f0122.js"><link rel="prefetch" href="/assets/index.html.ec47fbe3.js"><link rel="prefetch" href="/assets/index.html.cc5a4d45.js"><link rel="prefetch" href="/assets/index.html.c2bbc50f.js"><link rel="prefetch" href="/assets/index.html.be5402d3.js"><link rel="prefetch" href="/assets/index.html.51cf46d8.js"><link rel="prefetch" href="/assets/index.html.3cbbf1fa.js"><link rel="prefetch" href="/assets/index.html.9ab40022.js"><link rel="prefetch" href="/assets/index.html.a9822f56.js"><link rel="prefetch" href="/assets/index.html.781e83e5.js"><link rel="prefetch" href="/assets/index.html.19fef5af.js"><link rel="prefetch" href="/assets/index.html.a7e81c8c.js"><link rel="prefetch" href="/assets/index.html.0f0f923f.js"><link rel="prefetch" href="/assets/index.html.cab64beb.js"><link rel="prefetch" href="/assets/index.html.062f997a.js"><link rel="prefetch" href="/assets/index.html.87d5dde1.js"><link rel="prefetch" href="/assets/index.html.12bda11a.js"><link rel="prefetch" href="/assets/index.html.5949d508.js"><link rel="prefetch" href="/assets/index.html.5fda5c00.js"><link rel="prefetch" href="/assets/index.html.eeb13bc6.js"><link rel="prefetch" href="/assets/index.html.3423743d.js"><link rel="prefetch" href="/assets/index.html.c87b06c2.js"><link rel="prefetch" href="/assets/index.html.fd727bd0.js"><link rel="prefetch" href="/assets/index.html.821bee43.js"><link rel="prefetch" href="/assets/index.html.c1f8b436.js"><link rel="prefetch" href="/assets/index.html.b7e42b99.js"><link rel="prefetch" href="/assets/index.html.382d26c0.js"><link rel="prefetch" href="/assets/index.html.80592da4.js"><link rel="prefetch" href="/assets/index.html.ee31c74a.js"><link rel="prefetch" href="/assets/index.html.d763d98b.js"><link rel="prefetch" href="/assets/index.html.34063bed.js"><link rel="prefetch" href="/assets/index.html.c8febeaa.js"><link rel="prefetch" href="/assets/index.html.e2f78d74.js"><link rel="prefetch" href="/assets/index.html.6e7f5f3e.js"><link rel="prefetch" href="/assets/index.html.ebeb1e58.js"><link rel="prefetch" href="/assets/index.html.874082f9.js"><link rel="prefetch" href="/assets/index.html.ab980c0c.js"><link rel="prefetch" href="/assets/index.html.7774ed2d.js"><link rel="prefetch" href="/assets/index.html.a4c7d7fa.js"><link rel="prefetch" href="/assets/index.html.99115fb9.js"><link rel="prefetch" href="/assets/index.html.e1fbdac0.js"><link rel="prefetch" href="/assets/404.852e4c3f.js"><link rel="prefetch" href="/assets/Layout.c7f3e1d4.js"><link rel="prefetch" href="/assets/Slide.adb384fd.js"><link rel="prefetch" href="/assets/Blog.1bb2e8cd.js"><link rel="prefetch" href="/assets/giscus.8fe73ced.js"><link rel="prefetch" href="/assets/auto.esm.2565cd3a.js"><link rel="prefetch" href="/assets/index.d8a59108.js"><link rel="prefetch" href="/assets/index.1842ee54.js"><link rel="prefetch" href="/assets/mermaid.esm.min.ee1e0284.js"><link rel="prefetch" href="/assets/highlight.esm.d982e650.js"><link rel="prefetch" href="/assets/markdown.esm.832a189d.js"><link rel="prefetch" href="/assets/math.esm.a3f84b6f.js"><link rel="prefetch" href="/assets/notes.esm.3c361cb7.js"><link rel="prefetch" href="/assets/reveal.esm.b96f05d8.js"><link rel="prefetch" href="/assets/search.esm.80da4a02.js"><link rel="prefetch" href="/assets/zoom.esm.8514a202.js"><link rel="prefetch" href="/assets/photoswipe.esm.218074cd.js">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="skip-link sr-only">Skip to content</a><!--]--><div class="theme-container has-toc"><!--[--><!--[--><header class="navbar"><div class="navbar-left"><button class="toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><a href="/" class="brand"><img class="logo" src="https://img-blog.csdnimg.cn/d16e11af2edb4972833f88083d2f0375.png" alt="è‰æ²é£"><!----><span class="site-name hide-in-pad">è‰æ²é£</span></a><!----></div><div class="navbar-center"><!----><nav class="nav-links"><div class="nav-item hide-in-mobile"><a href="/" class="nav-link" aria-label="ä¸»é¡µ"><span class="icon iconfont icon-home"></span>ä¸»é¡µ<!----></a></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="æŠ€æœ¯åšæ–‡"><span class="title"><span class="icon iconfont icon-xieboke"></span>æŠ€æœ¯åšæ–‡</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å†…åŠŸå¿ƒæ³•</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/basic/design-pattern/" class="nav-link" aria-label="è®¾è®¡æ¨¡å¼"><span class="icon iconfont icon-design"></span>è®¾è®¡æ¨¡å¼<!----></a></li><li class="dropdown-subitem"><a href="/posts/basic/design-principle/%E5%BC%80%E9%97%AD%E5%8E%9F%E5%88%99.html" class="nav-link" aria-label="è®¾è®¡åŸåˆ™"><span class="icon iconfont icon-design"></span>è®¾è®¡åŸåˆ™<!----></a></li></ul></li><li class="dropdown-item"><h4 class="dropdown-subtitle"><span>å­˜å‚¨ç¯‡</span></h4><ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/posts/storage/MySQL" class="nav-link" aria-label="MySQL"><span class="icon iconfont icon-mysql"></span>MySQL<!----></a></li><li class="dropdown-subitem"><a href="/posts/storage/Redis" class="nav-link" aria-label="Redis"><span class="icon iconfont icon-redis"></span>Redis<!----></a></li><li class="dropdown-subitem"><a href="/posts/storage/ElasticSearch" class="nav-link" aria-label="ElasticSearch"><span class="icon iconfont icon-elasticsearch-Elasticsearch"></span>ElasticSearch<!----></a></li></ul></li><li class="dropdown-item"><a href="/posts/concurrency" class="nav-link active" aria-label="å¹¶å‘ç¯‡"><span class="icon iconfont icon-CPU"></span>å¹¶å‘ç¯‡<!----></a></li><li class="dropdown-item"><a href="/posts/JVM" class="nav-link" aria-label="JVM"><span class="icon iconfont icon-PCxuniji"></span>JVM<!----></a></li><li class="dropdown-item"><a href="/posts/os" class="nav-link" aria-label="Linux"><span class="icon iconfont icon-linux"></span>Linux<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><div class="dropdown-wrapper"><button class="dropdown-title" type="button" aria-label="å¼€å‘å·¥å…·"><span class="title"><span class="icon iconfont icon-keyboard"></span>å¼€å‘å·¥å…·</span><span class="arrow"></span><ul class="nav-dropdown"><li class="dropdown-item"><a href="/posts/tools/IDEA" class="nav-link" aria-label="IDEA"><span class="icon iconfont icon-jetbrains"></span>IDEA<!----></a></li><li class="dropdown-item"><a href="/posts/tools/VSCode" class="nav-link" aria-label="VSCode"><span class="icon iconfont icon-VsCode"></span>VSCode<!----></a></li></ul></button></div></div><div class="nav-item hide-in-mobile"><a href="/posts/network-programming" class="nav-link" aria-label="socketç¼–ç¨‹"><span class="icon iconfont icon-wangluojiekou"></span>socketç¼–ç¨‹<!----></a></div><div class="nav-item hide-in-mobile"><a href="/update.html" class="nav-link" aria-label="æœ€è¿‘æ›´æ–°"><span class="icon iconfont icon-Update"></span>æœ€è¿‘æ›´æ–°<!----></a></div><div class="nav-item hide-in-mobile"><a href="https://space.bilibili.com/519360358" rel="noopener noreferrer" target="_blank" aria-label class="nav-link"><span class="icon iconfont icon-bilibili"></span><span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span><!----></a></div></nav><!----></div><div class="navbar-right"><!----><!----><div class="nav-item"><a class="repo-link" href="https://github.com/chanmufeng/chanmufeng.github.io" target="_blank" rel="noopener noreferrer" aria-label="GitHub"><svg xmlns="http://www.w3.org/2000/svg" class="icon github-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="github icon" style="width:1.25rem;height:1.25rem;vertical-align:middle;"><path d="M511.957 21.333C241.024 21.333 21.333 240.981 21.333 512c0 216.832 140.544 400.725 335.574 465.664 24.49 4.395 32.256-10.07 32.256-23.083 0-11.69.256-44.245 0-85.205-136.448 29.61-164.736-64.64-164.736-64.64-22.315-56.704-54.4-71.765-54.4-71.765-44.587-30.464 3.285-29.824 3.285-29.824 49.195 3.413 75.179 50.517 75.179 50.517 43.776 75.008 114.816 53.333 142.762 40.79 4.523-31.66 17.152-53.377 31.19-65.537-108.971-12.458-223.488-54.485-223.488-242.602 0-53.547 19.114-97.323 50.517-131.67-5.035-12.33-21.93-62.293 4.779-129.834 0 0 41.258-13.184 134.912 50.346a469.803 469.803 0 0 1 122.88-16.554c41.642.213 83.626 5.632 122.88 16.554 93.653-63.488 134.784-50.346 134.784-50.346 26.752 67.541 9.898 117.504 4.864 129.834 31.402 34.347 50.474 78.123 50.474 131.67 0 188.586-114.73 230.016-224.042 242.09 17.578 15.232 33.578 44.672 33.578 90.454v135.85c0 13.142 7.936 27.606 32.854 22.87C862.25 912.597 1002.667 728.747 1002.667 512c0-271.019-219.648-490.667-490.71-490.667z"></path></svg></a></div><div class="nav-item hide-in-mobile"><button id="appearance-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="light icon" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><div id="docsearch-container"></div><!----><button class="toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span class="button-container"><span class="button-top"></span><span class="button-middle"></span><span class="button-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow left"></span></div><aside class="sidebar"><!--[--><!----><!--]--><ul class="sidebar-links"><li><!--[--><section class="sidebar-group"><p class="sidebar-heading"><!----><span class="title">0. è¶£è°ˆ</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/posts/concurrency/%E7%94%A8%E3%80%8C%E9%97%AA%E7%94%B5%E4%BE%A0%E3%80%8D%E8%A7%A3%E9%87%8A%E4%B8%80%E4%B8%8B%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B.html" class="nav-link sidebar-link sidebar-page" aria-label="ç”¨ã€Œé—ªç”µä¾ ã€è§£é‡Šä¸€ä¸‹è¿›ç¨‹å’Œçº¿ç¨‹"><span class="icon iconfont icon-creative"></span>ç”¨ã€Œé—ªç”µä¾ ã€è§£é‡Šä¸€ä¸‹è¿›ç¨‹å’Œçº¿ç¨‹<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li></ul></section><!--]--></li><li><!--[--><section class="sidebar-group"><p class="sidebar-heading active"><!----><span class="title">1. ç¡¬ä»¶ç¯‡</span><!----></p><ul class="sidebar-links"><li><!--[--><a href="/posts/concurrency/CPU%E6%B5%81%E6%B0%B4%E7%BA%BF%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92%E5%BA%8F.html" class="nav-link sidebar-link sidebar-page" aria-label="CPUæµæ°´çº¿ä¸æŒ‡ä»¤é‡æ’åº"><span class="icon iconfont icon-creative"></span>CPUæµæ°´çº¿ä¸æŒ‡ä»¤é‡æ’åº<!----></a><ul class="sidebar-sub-headers"></ul><!--]--></li><li><!--[--><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html" class="router-link-active router-link-exact-active nav-link active sidebar-link sidebar-page active" aria-label="ç¼“å­˜ä¸€è‡´æ€§ä¸å†…å­˜å±éšœ"><span class="icon iconfont icon-creative"></span>ç¼“å­˜ä¸€è‡´æ€§ä¸å†…å­˜å±éšœ<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_1-é«˜é€Ÿç¼“å­˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1. é«˜é€Ÿç¼“å­˜"><!---->1. é«˜é€Ÿç¼“å­˜<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_1-1-ä»€ä¹ˆæ˜¯é«˜é€Ÿç¼“å­˜cache" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.1. ä»€ä¹ˆæ˜¯é«˜é€Ÿç¼“å­˜Cache"><!---->1.1. ä»€ä¹ˆæ˜¯é«˜é€Ÿç¼“å­˜Cache<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_1-2-ç¼“å­˜è¡Œ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="1.2. ç¼“å­˜è¡Œ"><!---->1.2. ç¼“å­˜è¡Œ<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_2-ä¼ªå…±äº«é—®é¢˜" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2. ä¼ªå…±äº«é—®é¢˜"><!---->2. ä¼ªå…±äº«é—®é¢˜<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_2-1-ä»€ä¹ˆæ˜¯ä¼ªå…±äº«" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.1. ä»€ä¹ˆæ˜¯ä¼ªå…±äº«"><!---->2.1. ä»€ä¹ˆæ˜¯ä¼ªå…±äº«<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_2-2-è§£å†³ä¼ªå…±äº«" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="2.2. è§£å†³ä¼ªå…±äº«"><!---->2.2. è§£å†³ä¼ªå…±äº«<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_3-æ€»çº¿é”" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="3. æ€»çº¿é”"><!---->3. æ€»çº¿é”<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_4-ç¼“å­˜é”" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="4. ç¼“å­˜é”"><!---->4. ç¼“å­˜é”<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_5-ç¼“å­˜ä¸€è‡´æ€§åè®®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5. ç¼“å­˜ä¸€è‡´æ€§åè®®"><!---->5. ç¼“å­˜ä¸€è‡´æ€§åè®®<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_5-1-mesi" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.1. MESI"><!---->5.1. MESI<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_5-2-cpuä¹‹é—´çš„-é»‘è¯" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.2. CPUä¹‹é—´çš„â€œé»‘è¯â€"><!---->5.2. CPUä¹‹é—´çš„â€œé»‘è¯â€<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_5-3-mesiçŠ¶æ€è·ƒè¿ç¤ºä¾‹" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="5.3. MESIçŠ¶æ€è·ƒè¿ç¤ºä¾‹"><!---->5.3. MESIçŠ¶æ€è·ƒè¿ç¤ºä¾‹<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-ä¸èƒ½è®©cpué—²ç€" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6. ä¸èƒ½è®©CPUé—²ç€"><!---->6. ä¸èƒ½è®©CPUé—²ç€<!----></a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-1-å¼•å…¥store-buffers" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.1. å¼•å…¥Store Buffers"><!---->6.1. å¼•å…¥Store Buffers<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-2-store-bufferså¼•èµ·çš„é—®é¢˜1" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.2. Store Bufferså¼•èµ·çš„é—®é¢˜1"><!---->6.2. Store Bufferså¼•èµ·çš„é—®é¢˜1<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-3-å¼•å…¥store-forwarding" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.3. å¼•å…¥Store Forwarding"><!---->6.3. å¼•å…¥Store Forwarding<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-4-store-bufferså¼•èµ·çš„é—®é¢˜2" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.4. Store Bufferså¼•èµ·çš„é—®é¢˜2"><!---->6.4. Store Bufferså¼•èµ·çš„é—®é¢˜2<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-5-å†…å­˜å±éšœ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.5. å†…å­˜å±éšœ"><!---->6.5. å†…å­˜å±éšœ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-6-store-bufferså¼•èµ·çš„é—®é¢˜3" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.6. Store Bufferså¼•èµ·çš„é—®é¢˜3"><!---->6.6. Store Bufferså¼•èµ·çš„é—®é¢˜3<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-7-å¼•å…¥invalidate-queues" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="6.7. å¼•å…¥Invalidate Queues"><!---->6.7. å¼•å…¥Invalidate Queues<!----></a><ul class="sidebar-sub-headers"></ul></li></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_7-è¯»å†…å­˜å±éšœ-å†™å†…å­˜å±éšœ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="7. è¯»å†…å­˜å±éšœ &amp; å†™å†…å­˜å±éšœ"><!---->7. è¯»å†…å­˜å±éšœ &amp; å†™å†…å­˜å±éšœ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_8-æ€»ç»“" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="8. æ€»ç»“"><!---->8. æ€»ç»“<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_9-åè®°" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="9. åè®°"><!---->9. åè®°<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_10-é™„å½•1â€”â€”mesiè·ƒè¿åœºæ™¯è§£æ" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="10. é™„å½•1â€”â€”MESIè·ƒè¿åœºæ™¯è§£æ"><!---->10. é™„å½•1â€”â€”MESIè·ƒè¿åœºæ™¯è§£æ<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_11-é™„å½•2â€”â€”mesiåœ¨çº¿ç½‘ç«™ä½¿ç”¨" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="11. é™„å½•2â€”â€”MESIåœ¨çº¿ç½‘ç«™ä½¿ç”¨"><!---->11. é™„å½•2â€”â€”MESIåœ¨çº¿ç½‘ç«™ä½¿ç”¨<!----></a><ul class="sidebar-sub-headers"></ul></li><li class="sidebar-sub-header"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_12-é™„å½•3â€”â€”å‚è€ƒæ–‡çŒ®" class="router-link-active router-link-exact-active nav-link sidebar-link heading" aria-label="12. é™„å½•3â€”â€”å‚è€ƒæ–‡çŒ®"><!---->12. é™„å½•3â€”â€”å‚è€ƒæ–‡çŒ®<!----></a><ul class="sidebar-sub-headers"></ul></li></ul><!--]--></li></ul></section><!--]--></li></ul><!--[--><!----><!--]--></aside><!--[--><main class="page" id="main-content"><!--[--><!----><nav class="breadcrumb disable"></nav><div class="page-title"><h1><span class="icon iconfont icon-creative"></span>ç¼“å­˜ä¸€è‡´æ€§ä¸å†…å­˜å±éšœ</h1><div class="page-info"><span class="author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="down" localizeddate="2022å¹´7æœˆ27æ—¥" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="author icon"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><a class="author-item" href="https://www.chanmufeng.com" target="_blank" rel="noopener noreferrer">è‰æ²é£</a></span><span property="author" content="è‰æ²é£"></span></span><!----><span class="date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="down" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span>2022å¹´7æœˆ27æ—¥</span><meta property="datePublished" content="2022-07-27T00:00:00.000Z"></span><span class="category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="down" localizeddate="2022å¹´7æœˆ27æ—¥" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="category icon"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><ul class="categories-wrapper"><li class="category category6 clickable" role="navigation">å¹¶å‘</li><meta property="articleSection" content="å¹¶å‘"></ul></span><span aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="down" localizeddate="2022å¹´7æœˆ27æ—¥" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="tag icon"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><ul class="tags-wrapper"><li class="tag tag5 clickable" role="navigation">ç¼“å­˜ä¸€è‡´æ€§</li><li class="tag tag6 clickable" role="navigation">å†…å­˜å±éšœ</li><li class="tag tag6 clickable" role="navigation">CPU</li></ul><meta property="keywords" content="ç¼“å­˜ä¸€è‡´æ€§,å†…å­˜å±éšœ,CPU"></span><span class="reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="down" localizeddate="2022å¹´7æœˆ27æ—¥" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="timer icon"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 38 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT38M"></span><!----><span class="words-info" aria-label="å­—æ•°ğŸ” " data-balloon-pos="down" localizeddate="2022å¹´7æœˆ27æ—¥" isoriginal="false" pageview="false"><svg xmlns="http://www.w3.org/2000/svg" class="icon word-icon" viewbox="0 0 1024 1024" fill="currentColor" aria-label="word icon"><path d="M518.217 432.64V73.143A73.143 73.143 0 01603.43 1.097a512 512 0 01419.474 419.474 73.143 73.143 0 01-72.046 85.212H591.36a73.143 73.143 0 01-73.143-73.143z"></path><path d="M493.714 566.857h340.297a73.143 73.143 0 0173.143 85.577A457.143 457.143 0 11371.566 117.76a73.143 73.143 0 0185.577 73.143v339.383a36.571 36.571 0 0036.571 36.571z"></path></svg><span>çº¦ 11250 å­—</span><meta property="wordCount" content="11250"></span></div><hr></div><div class="toc-place-holder"><aside id="toc"><div class="toc-header">æ­¤é¡µå†…å®¹</div><div class="toc-wrapper"><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_1-é«˜é€Ÿç¼“å­˜" class="router-link-active router-link-exact-active toc-link level2">1. é«˜é€Ÿç¼“å­˜</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_1-1-ä»€ä¹ˆæ˜¯é«˜é€Ÿç¼“å­˜cache" class="router-link-active router-link-exact-active toc-link level3">1.1. ä»€ä¹ˆæ˜¯é«˜é€Ÿç¼“å­˜Cache</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_1-2-ç¼“å­˜è¡Œ" class="router-link-active router-link-exact-active toc-link level3">1.2. ç¼“å­˜è¡Œ</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_2-ä¼ªå…±äº«é—®é¢˜" class="router-link-active router-link-exact-active toc-link level2">2. ä¼ªå…±äº«é—®é¢˜</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_2-1-ä»€ä¹ˆæ˜¯ä¼ªå…±äº«" class="router-link-active router-link-exact-active toc-link level3">2.1. ä»€ä¹ˆæ˜¯ä¼ªå…±äº«</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_2-2-è§£å†³ä¼ªå…±äº«" class="router-link-active router-link-exact-active toc-link level3">2.2. è§£å†³ä¼ªå…±äº«</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_3-æ€»çº¿é”" class="router-link-active router-link-exact-active toc-link level2">3. æ€»çº¿é”</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_4-ç¼“å­˜é”" class="router-link-active router-link-exact-active toc-link level2">4. ç¼“å­˜é”</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_5-ç¼“å­˜ä¸€è‡´æ€§åè®®" class="router-link-active router-link-exact-active toc-link level2">5. ç¼“å­˜ä¸€è‡´æ€§åè®®</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_5-1-mesi" class="router-link-active router-link-exact-active toc-link level3">5.1. MESI</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_5-2-cpuä¹‹é—´çš„-é»‘è¯" class="router-link-active router-link-exact-active toc-link level3">5.2. CPUä¹‹é—´çš„â€œé»‘è¯â€</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_5-3-mesiçŠ¶æ€è·ƒè¿ç¤ºä¾‹" class="router-link-active router-link-exact-active toc-link level3">5.3. MESIçŠ¶æ€è·ƒè¿ç¤ºä¾‹</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-ä¸èƒ½è®©cpué—²ç€" class="router-link-active router-link-exact-active toc-link level2">6. ä¸èƒ½è®©CPUé—²ç€</a></li><ul class="toc-list"><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-1-å¼•å…¥store-buffers" class="router-link-active router-link-exact-active toc-link level3">6.1. å¼•å…¥Store Buffers</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-2-store-bufferså¼•èµ·çš„é—®é¢˜1" class="router-link-active router-link-exact-active toc-link level3">6.2. Store Bufferså¼•èµ·çš„é—®é¢˜1</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-3-å¼•å…¥store-forwarding" class="router-link-active router-link-exact-active toc-link level3">6.3. å¼•å…¥Store Forwarding</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-4-store-bufferså¼•èµ·çš„é—®é¢˜2" class="router-link-active router-link-exact-active toc-link level3">6.4. Store Bufferså¼•èµ·çš„é—®é¢˜2</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-5-å†…å­˜å±éšœ" class="router-link-active router-link-exact-active toc-link level3">6.5. å†…å­˜å±éšœ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-6-store-bufferså¼•èµ·çš„é—®é¢˜3" class="router-link-active router-link-exact-active toc-link level3">6.6. Store Bufferså¼•èµ·çš„é—®é¢˜3</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_6-7-å¼•å…¥invalidate-queues" class="router-link-active router-link-exact-active toc-link level3">6.7. å¼•å…¥Invalidate Queues</a></li><!----><!--]--></ul><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_7-è¯»å†…å­˜å±éšœ-å†™å†…å­˜å±éšœ" class="router-link-active router-link-exact-active toc-link level2">7. è¯»å†…å­˜å±éšœ &amp; å†™å†…å­˜å±éšœ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_8-æ€»ç»“" class="router-link-active router-link-exact-active toc-link level2">8. æ€»ç»“</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_9-åè®°" class="router-link-active router-link-exact-active toc-link level2">9. åè®°</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_10-é™„å½•1â€”â€”mesiè·ƒè¿åœºæ™¯è§£æ" class="router-link-active router-link-exact-active toc-link level2">10. é™„å½•1â€”â€”MESIè·ƒè¿åœºæ™¯è§£æ</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_11-é™„å½•2â€”â€”mesiåœ¨çº¿ç½‘ç«™ä½¿ç”¨" class="router-link-active router-link-exact-active toc-link level2">11. é™„å½•2â€”â€”MESIåœ¨çº¿ç½‘ç«™ä½¿ç”¨</a></li><!----><!--]--><!--[--><li class="toc-item"><a aria-current="page" href="/posts/concurrency/%E7%BC%93%E5%AD%98%E4%B8%80%E8%87%B4%E6%80%A7%E4%B8%8E%E5%86%85%E5%AD%98%E5%B1%8F%E9%9A%9C.html#_12-é™„å½•3â€”â€”å‚è€ƒæ–‡çŒ®" class="router-link-active router-link-exact-active toc-link level2">12. é™„å½•3â€”â€”å‚è€ƒæ–‡çŒ®</a></li><!----><!--]--></ul></div></aside></div><!----><div class="theme-hope-content"><p>æ•…äº‹è¿˜å¾—ä»ä¸€ä¸ªçŸ›ç›¾è¯´èµ·ã€‚</p><p>æ‘©å°”å®šå¾‹å‘Šè¯‰æˆ‘ä»¬ï¼šå¤§çº¦æ¯18ä¸ªæœˆä¼šå°†èŠ¯ç‰‡çš„æ€§èƒ½æé«˜ä¸€å€ã€‚èŠ¯ç‰‡çš„è¿™ç§é£é€Ÿå‘å±•ç›´æ¥å¯¼è‡´äº†èŠ¯ç‰‡çš„æŒ‡ä»¤æ‰§è¡Œé€Ÿåº¦ä¸å†…å­˜è¯»å–é€Ÿåº¦ä¹‹é—´çš„å·¨å¤§é¸¿æ²Ÿã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼ŒCPUåœ¨1çº³ç§’ä¹‹å†…å¯ä»¥æ‰§è¡Œå‡ åæ¡æŒ‡ä»¤ï¼Œä½†æ˜¯ä»å†…å­˜ä¸­è¯»å–ä¸€æ¡æ•°æ®å°±éœ€è¦èŠ±è´¹å‡ åçº³ç§’ã€‚è¿™ç§æ•°é‡çº§çš„å·®å¼‚ä¾¿æ˜¯è®¡ç®—æœºä¸­çš„ä¸€ä¸ªä¸»è¦çŸ›ç›¾ï¼š</p><blockquote><p>CPUæ—¥ç›Šå¢é•¿çš„å¯¹æ•°æ®å¿«é€Ÿè¯»å–çš„éœ€è¦å’ŒI/Oè®¾å¤‡è¯»å–é€Ÿåº¦ä¸å¹³è¡¡ä¸å……åˆ†çš„å‘å±•ä¹‹é—´çš„çŸ›ç›¾</p></blockquote><p>è€ŒCPUè¿è¡Œæ‰€éœ€è¦çš„æŒ‡ä»¤å’Œæ•°æ®éƒ½å­˜å‚¨åœ¨ä½é€Ÿçš„å†…å­˜ä¸­ï¼Œäººä»¬æ— æ³•å®¹å¿è®©CPUè¿™æ ·å®è´µçš„é«˜é€Ÿè®¾å¤‡è¿›è¡Œæ¼«é•¿çš„ç­‰å¾…ã€‚</p><p>è®¡ç®—æœºç§‘å­¦é¢†åŸŸçš„ä»»ä½•é—®é¢˜éƒ½å¯ä»¥é€šè¿‡å¢åŠ ä¸€ä¸ªä¸­é—´å±‚æ¥è§£å†³ã€‚æ‰€ä»¥éœ€è¦ä¸€ä¸ªæ¯”å†…å­˜æ›´å¿«çš„å­˜å–è®¾å¤‡åšç¼“å†²ï¼Œ<strong>å°½é‡</strong>åšåˆ°å’ŒCPUä¸€æ ·å¿«ï¼Œè¿™æ ·å°±ä¸éœ€è¦æ¯æ¬¡éƒ½ä»ä½é€Ÿçš„å†…å­˜ä¸­è·å–æ•°æ®äº†ã€‚</p><p>äºæ˜¯å¼•å…¥äº†é«˜é€Ÿç¼“å­˜ã€‚</p><h2 id="_1-é«˜é€Ÿç¼“å­˜" tabindex="-1"><a class="header-anchor" href="#_1-é«˜é€Ÿç¼“å­˜" aria-hidden="true">#</a> 1. é«˜é€Ÿç¼“å­˜</h2><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024316.png" alt="img" loading="lazy"></p><p>æˆ‘ä»¬å·²ç»çŸ¥é“ä¸ºä»€ä¹ˆéœ€è¦é«˜é€Ÿç¼“å­˜äº†ã€‚é‚£ä¹ˆä»€ä¹ˆæ˜¯é«˜é€Ÿç¼“å­˜ï¼Ÿå®ƒä¸ºä»€ä¹ˆå°±æ¯”å†…å­˜å¿«ï¼Ÿæ—¢ç„¶è¿™ä¹ˆå¿«ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥å½“æˆå†…å­˜ç”¨ï¼Ÿ</p><p>åˆ«æ€¥ï¼Œæˆ‘ä¸€ç‚¹ç‚¹è§£é‡Šã€‚</p><h3 id="_1-1-ä»€ä¹ˆæ˜¯é«˜é€Ÿç¼“å­˜cache" tabindex="-1"><a class="header-anchor" href="#_1-1-ä»€ä¹ˆæ˜¯é«˜é€Ÿç¼“å­˜cache" aria-hidden="true">#</a> 1.1. ä»€ä¹ˆæ˜¯é«˜é€Ÿç¼“å­˜Cache</h3><p>æˆ‘ä»¬æœ€ç†Ÿæ‚‰çš„å†…å­˜æ˜¯ä¸€ç§<strong>åŠ¨æ€éšæœºè®¿é—®å­˜å‚¨å™¨ï¼ˆDynamic RAM,DRAMï¼‰</strong>ï¼Œå­˜å‚¨å™¨ä¸­æ¯ä¸ªå­˜å‚¨å•å…ƒç”±é…å¯¹å‡ºç°çš„æ™¶ä½“ç®¡å’Œç”µå®¹å™¨æ„æˆï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œå›ºå®šè¦å¯¹<strong>DRAM</strong>åˆ·æ–°å……ç”µä¸€æ¬¡ï¼Œå¦åˆ™å†…éƒ¨çš„æ•°æ®å°±ä¼šæ¶ˆå¤±ã€‚</p><p>è€Œé«˜é€Ÿç¼“å­˜æ˜¯ä¸€ç§<strong>é™æ€éšæœºè®¿é—®å­˜å‚¨å™¨ï¼ˆStatic RAM,SRAMï¼‰</strong>ï¼Œä¸éœ€è¦åˆ·æ–°ç”µè·¯å°±èƒ½ä¿å­˜å®ƒå†…éƒ¨å­˜å‚¨çš„æ•°æ®ï¼Œè¿™å°±æ˜¯é™æ€çš„å«ä¹‰ï¼Œå› æ­¤<strong>SRAM</strong>çš„å­˜å‚¨æ€§èƒ½éå¸¸é«˜ï¼å·¥ä½œé€Ÿåº¦åœ¨çº³ç§’çº§åˆ«ï¼Œå‹‰å¼ºèƒ½è·Ÿå¾—ä¸ŠCPUçš„è¿ç®—é€Ÿåº¦ã€‚</p><p>ä½†æ˜¯<strong>SRAM</strong>çš„ç¼ºç‚¹å°±æ˜¯é›†æˆåº¦ä½ï¼Œç›¸åŒå®¹é‡çš„å†…å­˜å¯ä»¥è®¾è®¡æˆè¾ƒå°çš„ä½“ç§¯ï¼Œä½†æ˜¯<strong>SRAM</strong>å´éœ€è¦æ›´å¤§çš„ä½“ç§¯ï¼›è€Œä¸”ï¼Œ<strong>SRAM</strong>è¿™ç©æ„å„¿å·¨è´µï¼è¿™å°±æ˜¯ä¸èƒ½ç›´æ¥æŠŠå®ƒå½“å†…å­˜ç”¨çš„åŸå› ã€‚</p><p>è¶Šé è¿‘CPUæ ¸å¿ƒåœ°å¸¦çš„è®¾å¤‡è¶Šéœ€è¦å¼ºæ‚çš„æ€§èƒ½ï¼Œå¯æ˜¯å®¹é‡å¦‚æœå¤ªå°åˆå¸®ä¸ä¸Šå¤ªå¤§çš„å¿™ã€‚å¦‚æœä¸€ä¸ªä¸­é—´å±‚ï¼ˆä¸€å±‚é«˜é€Ÿç¼“å­˜ï¼‰ä¸èƒ½é«˜æ•ˆè§£å†³é—®é¢˜ï¼Œé‚£å°±å¤šæ¥å‡ ä¸ªä¸­é—´å±‚ã€‚ç›®å‰CPUçš„è§£å†³æ€è·¯ä¸€èˆ¬æ˜¯ä»¥é‡å–èƒœï¼Œæ¯”å¦‚åŒæ—¶è®¾ç½®<code>L1</code>ã€<code>L2</code>ã€<code>L3</code>ä¸‰çº§ç¼“å­˜ã€‚</p><p>åœ¨ç¼“å­˜å®¹é‡ä¸Šï¼Œé€šå¸¸æ˜¯<code>å†…å­˜ &gt; L3 &gt; L2 &gt; L1</code>ï¼Œå®¹é‡è¶Šå°é€Ÿåº¦è¶Šå¿«ã€‚å…¶ä¸­<code>L1</code>å’Œ<code>L2</code>æ˜¯ç”±æ¯ä¸ªCPUæ ¸å¿ƒç‹¬äº«çš„ï¼Œ<code>L3</code>ç¼“å­˜æ˜¯ç”±æ‰€æœ‰CPUæ ¸å¿ƒå…±äº«çš„ã€‚CPUçš„æ¶æ„è§ä¸‹å›¾ï¼š</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024327.png" alt="ç°ä»£CPUæ¶æ„" loading="lazy"></p><p>éœ€è¦ç‰¹åˆ«è¯´æ˜çš„æ˜¯ï¼Œ<code>L1</code>ç¼“å­˜åˆåˆ†ä¸ºäº†<code>L1d</code>æ•°æ®ç¼“å­˜ï¼ˆL1 Dataï¼‰å’Œ<code>L1i</code>æŒ‡ä»¤ç¼“å­˜ï¼ˆL1 Instructï¼‰ï¼Œä¸Šå›¾ä¸ºäº†å®Œæ•´æ€§ä¸€å¹¶ç”»å‡ºäº†ï¼Œæœ¬æ–‡ä¸­çš„é«˜é€Ÿç¼“å­˜ä¸€å¾‹æŒ‡æ•°æ®ç¼“å­˜ã€‚</p><p>ä¸ºäº†æ¥ä¸‹æ¥æ–¹ä¾¿è®²è§£ï¼Œæˆ‘ä»¬æŠŠä¸‰çº§ç¼“å­˜æ¨¡å‹ç®€åŒ–ä¸ºä¸€çº§ç¼“å­˜æ¨¡å‹ï¼Œæ¯•ç«Ÿé“ç†éƒ½æ˜¯ç›¸é€šçš„å˜›ã€‚çœ‹ä¸€ä¸‹ç®€åŒ–ä¹‹åçš„å›¾ã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024334.png" alt="ç®€åŒ–çš„é«˜é€Ÿç¼“å­˜æ¶æ„" loading="lazy"></p><h3 id="_1-2-ç¼“å­˜è¡Œ" tabindex="-1"><a class="header-anchor" href="#_1-2-ç¼“å­˜è¡Œ" aria-hidden="true">#</a> 1.2. ç¼“å­˜è¡Œ</h3><p>è¯´å®Œäº†ä»€ä¹ˆæ˜¯Cacheï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹Cacheé‡Œè£…çš„åˆ°åº•æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>è¿™ä¸æ˜¯åºŸè¯å˜›ï¼Œè‚¯å®šè£…çš„æ˜¯æ•°æ®å•Šã€‚æ²¡é”™ï¼Œæ˜¯ä»å†…å­˜ä¸­è·å–åˆ°çš„æ•°æ®ï¼Œä½†æ˜¯æ•°æ®çš„å•ä½å‘¢ï¼ŸCPUæ¯æ¬¡åªæŠŠéœ€è¦çš„æ•°æ®ä»å†…å­˜ä¸­è¯»å–åˆ°Cacheå°±è¡Œäº†å—ï¼Ÿè‚¯å®šä¸æ˜¯ï¼Œæˆ‘ä»¬æƒ³ä¸€ä¸‹ï¼ŒåªæŠŠéœ€è¦çš„ä¸€ä¸ªæ•°æ®ä»å†…å­˜ä¸­è¯»åˆ°Cacheï¼ŒCPUå†ä»Cacheä¸­ç»§ç»­è¯»è¿™ä¸ªæ•°æ®è¿›è¡Œå¤„ç†ï¼ŒCacheçš„å­˜åœ¨å®Œå…¨å°±æ˜¯å¤šæ­¤ä¸€ä¸¾ï¼Œè¿˜ä¸å¦‚ç›´æ¥ä»å†…å­˜è¯»æ•°æ®å‘¢ã€‚</p><p>æ‰€ä»¥è¦æƒ³è®©Cacheå……åˆ†å‘æŒ¥ä½œç”¨ï¼Œå¿…é¡»è®©å®ƒåšç‚¹â€œå¤šä½™â€çš„äº‹æƒ…ã€‚å› æ­¤ä»å†…å­˜ä¸­è·å–æ•°æ®çš„æ—¶å€™ï¼Œæˆ‘ä»¬æŠŠåŒ…å«ç›®æ ‡æ•°æ®çš„ä¸€æ•´å—å†…å­˜æ•°æ®éƒ½æ”¾å…¥Cacheä¸­ã€‚åˆ«å°çœ‹è¿™ä¸ªåŠ¨ä½œï¼Œå®ƒæœ‰ä¸ªç§‘å­¦çš„è§£é‡Šï¼Œå«åš<strong>ç©ºé—´å±€éƒ¨æ€§</strong>ã€‚</p><blockquote><p>ä½ç½®ç›¸é‚»çš„æ•°æ®å¸¸å¸¸ä¼šåœ¨ç›¸è¿‘çš„æ—¶é—´å†…è¢«è®¿é—®</p></blockquote><p>æ ¹æ®<strong>ç©ºé—´å±€éƒ¨æ€§</strong>åŸç†ï¼Œå¦‚æœç›®æ ‡æ•°æ®ç›¸é‚»çš„æ•°æ®è¢«è®¿é—®ï¼ŒCPUå°±ä¸éœ€è¦å†ä»å†…å­˜ä¸­è·å–äº†ï¼Œè¿™ç§ç›´æ¥ä»Cacheä¸­è·å–åˆ°ç›®æ ‡æ•°æ®çš„è¡Œä¸ºå«åšâ€œ<strong>ç¼“å­˜å‘½ä¸­</strong>â€ï¼Œæå¤§åœ°æé«˜äº†CPUçš„å·¥ä½œæ•ˆç‡ã€‚å¦‚æœCacheé‡Œè¾¹æ²¡æœ‰ï¼Œå°±ç§°ä¸º<strong>Cache Miss</strong>ï¼ŒCPUéœ€è¦å†ç­‰å¾…å‡ åä¸ªæŒ‡ä»¤å‘¨æœŸä»å†…å­˜ä¸­æŠŠè¿™ä¸€æ•´å—å†…å­˜æ•°æ®è¯»å…¥Cacheã€‚</p><p>ç»™å­˜å‚¨â€œä¸€æ•´å—å†…å­˜æ•°æ®â€çš„åœ°æ–¹èµ·ä¸ªåå­—ï¼Œå«ã€Œ<strong>ç¼“å­˜è¡Œ</strong>ã€ï¼ˆ<strong>Cache Line</strong>ï¼‰ã€‚</p><p>Cacheæ˜¯ç”±ç¼“å­˜è¡Œç»„æˆçš„ï¼Œç¼“å­˜è¡Œæ˜¯CPUé«˜é€Ÿç¼“å­˜å’Œå†…å­˜äº¤äº’çš„æœ€å°å•å…ƒã€‚åœ¨X86æ¶æ„ä¸­ï¼Œç¼“å­˜è¡Œçš„å¤§å°æ˜¯64ä¸ªå­—èŠ‚ï¼Œå¤§å°å’ŒCPUå…·ä½“å‹å·æœ‰å…³ã€‚æœ¬æ–‡åªå…³æ³¨ç¼“å­˜è¡Œçš„æŠ½è±¡æ¦‚å¿µï¼Œä¸æ¶‰åŠå…·ä½“çš„ç¼“å­˜è¡Œå¤§å°ã€‚</p><hr><p>æ¥ä¸‹æ¥ï¼Œç»ˆäºè¦è¿›å…¥æœ¬æ–‡çš„æ­£å¼éƒ¨åˆ†äº†ã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024341.png" alt="img" loading="lazy"></p><p>æˆ‘ä¸€ç›´è®¤ä¸ºï¼Œè®¡ç®—æœºçš„æ¼”è¿›å°±æ˜¯ä¸€éƒ¨åœ¨æŒ–å‘å’Œå¡«å‘ä¹‹é—´åå¤æ¨ªè·³çš„å‘å±•å²ã€‚å¯¹è¿™ä¸€ç‚¹çš„ç†è§£ä¼šéšç€æœ¬æ–‡çš„åç»­è®²è¿°é€æ¸åŠ æ·±ã€‚æ¯”å¦‚é«˜é€Ÿç¼“å­˜Cacheå¾ˆå¥½åœ°è§£å†³äº†CPUä¸å†…å­˜çš„é€Ÿåº¦çŸ›ç›¾ï¼Œä½†æ˜¯ä¹Ÿä¸ºè®¡ç®—æœºç³»ç»Ÿå¸¦æ¥äº†æ›´é«˜çš„å¤æ‚åº¦ï¼Œæˆ‘æ¥ä¸¾ä¸ªä¾‹å­ã€‚</p><h2 id="_2-ä¼ªå…±äº«é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_2-ä¼ªå…±äº«é—®é¢˜" aria-hidden="true">#</a> 2. ä¼ªå…±äº«é—®é¢˜</h2><p>æˆ‘ä»¬åˆ°ç›®å‰ä¸ºæ­¢è¯´çš„éƒ½æ˜¯CPUä»Cacheä¸­readæ•°æ®ï¼Œä½†æ˜¯æ€»å¾—æœ‰writeçš„æ—¶å€™å§ã€‚æ—¢ç„¶æœ‰äº†Cacheï¼Œè‚¯å®šå°±å¾—å…ˆæŠŠå€¼writeåˆ°Cacheä¸­ï¼Œå†æ›´æ–°åˆ°å†…å­˜é‡Œå•Šã€‚é‚£ä¹ˆï¼Œé—®é¢˜æ¥äº†ã€‚</p><h3 id="_2-1-ä»€ä¹ˆæ˜¯ä¼ªå…±äº«" tabindex="-1"><a class="header-anchor" href="#_2-1-ä»€ä¹ˆæ˜¯ä¼ªå…±äº«" aria-hidden="true">#</a> 2.1. ä»€ä¹ˆæ˜¯ä¼ªå…±äº«</h3><p><img src="http://qiniu.chanmufeng.com/2022-07-15-134306.gif" alt="ä¼ªå…±äº«é—®é¢˜" loading="lazy"></p><p>æ•°æ®<code>X</code>ã€<code>Y</code>ã€<code>Z</code>åŒå¤„äºä¸€ä¸ªç¼“å­˜è¡Œå†…ï¼Œ<code>Core0</code>å’Œ<code>Core1</code>åŒæ—¶åŠ è½½äº†è¯¥ç¼“å­˜è¡Œåˆ°Cacheä¸­ï¼Œæ­¤æ—¶<code>Core0</code>ä¿®æ”¹äº†è¯¥ç¼“å­˜è¡Œä¸­çš„<code>X</code>ä¸º<code>X1</code>ï¼Œå¦‚æœæ­¤æ—¶<code>Core1</code>ä¹Ÿæƒ³ä¿®æ”¹<code>Y</code>ä¸º<code>Y1</code>è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>ç”±äºç¼“å­˜è¡Œæ˜¯Cacheå’Œå†…å­˜ä¹‹é—´äº¤äº’çš„æœ€å°å•å…ƒï¼Œæ‰€ä»¥<code>Core0</code>æ ¹æœ¬ä¸çŸ¥é“<code>Core1</code>ä¿®æ”¹çš„æ˜¯ç¼“å­˜ä¸­çš„<code>Y</code>è¿˜æ˜¯<code>X</code>ï¼Œæ‰€ä»¥ä¸ºäº†é˜²æ­¢é€ æˆå¹¶å‘é—®é¢˜ï¼Œæœ€å¥½çš„åŠæ³•å°±æ˜¯è®©<code>Core1</code>ä¸­çš„è¯¥ç¼“å­˜è¡Œå¤±æ•ˆï¼Œé‡æ–°åŠ è½½ã€‚è¿™å°±æ˜¯<strong>ä¼ªå…±äº«</strong>é—®é¢˜ã€‚</p><p>ä¼ªå…±äº«é—®é¢˜çš„å®šä¹‰ï¼š<strong>å½“å¤šæ ¸å¿ƒä¿®æ”¹äº’ç›¸ç‹¬ç«‹çš„å˜é‡æ—¶ï¼Œå¦‚æœè¿™äº›å˜é‡å…±äº«åŒä¸€ä¸ªç¼“å­˜è¡Œï¼Œå°±ä¼šæ— æ„ä¸­å½±å“å½¼æ­¤çš„æ€§èƒ½ï¼Œè¿™å°±æ˜¯ä¼ªå…±äº«</strong>ã€‚</p><h3 id="_2-2-è§£å†³ä¼ªå…±äº«" tabindex="-1"><a class="header-anchor" href="#_2-2-è§£å†³ä¼ªå…±äº«" aria-hidden="true">#</a> 2.2. è§£å†³ä¼ªå…±äº«</h3><p>æ—¢ç„¶é—®é¢˜æ˜¯ç”±å¤šä¸ªå˜é‡å…±äº«ä¸€ä¸ªç¼“å­˜è¡Œå¯¼è‡´çš„ï¼Œé‚£å°±è®©<code>Y</code>å˜é‡ç‹¬äº«ä¸€ä¸ªç¼“å­˜è¡Œå°±å¥½äº†ã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024350.png" alt="ç¼“å­˜è¡Œå¡«å……" loading="lazy"></p><p>æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯é€šè¿‡ä»£ç æ‰‹åŠ¨è¿›è¡Œå­—èŠ‚å¡«å……ï¼Œæ‹¿æ—©æœŸçš„<code>LinkedTransferQueue</code>ä¸­çš„éƒ¨åˆ†æºç ä¸¾ä¸ªä¾‹å­ï¼Œæ³¨æ„çœ‹æ³¨é‡Šå†…å®¹ï¼š</p><div class="language-java ext-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">static</span> <span class="token keyword">final</span> <span class="token keyword">class</span> <span class="token class-name">PaddedAtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">extends</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">T</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token comment">// è¿½åŠ 15ä¸ªå¯¹è±¡å¼•ç”¨,ä¸€ä¸ªå¯¹è±¡å¼•ç”¨å æ®4ä¸ªå­—èŠ‚</span>
    <span class="token comment">// åŠ ä¸Šç»§æ‰¿è‡ªçˆ¶ç±»çš„valueï¼Œå…±64å­—èŠ‚ï¼Œæ­£å¥½å ä¸€ä¸ªç¼“å­˜è¡Œ</span>
    <span class="token class-name">Object</span> p0<span class="token punctuation">,</span> p1<span class="token punctuation">,</span> p2<span class="token punctuation">,</span> p3<span class="token punctuation">,</span> p4<span class="token punctuation">,</span> p5<span class="token punctuation">,</span> p6<span class="token punctuation">,</span> p7<span class="token punctuation">,</span> p8<span class="token punctuation">,</span> p9<span class="token punctuation">,</span> pa<span class="token punctuation">,</span> pb<span class="token punctuation">,</span> pc<span class="token punctuation">,</span> pd<span class="token punctuation">,</span> pe<span class="token punctuation">;</span>
    <span class="token class-name">PaddedAtomicReference</span><span class="token punctuation">(</span><span class="token class-name">T</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">super</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">//çˆ¶ç±»</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">AtomicReference</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">V</span><span class="token punctuation">&gt;</span></span> <span class="token keyword">implements</span> <span class="token class-name"><span class="token namespace">java<span class="token punctuation">.</span>io<span class="token punctuation">.</span></span>Serializable</span> <span class="token punctuation">{</span>
    <span class="token keyword">private</span> <span class="token keyword">volatile</span> <span class="token class-name">V</span> value<span class="token punctuation">;</span>
    <span class="token keyword">public</span> <span class="token class-name">AtomicReference</span><span class="token punctuation">(</span><span class="token class-name">V</span> initialValue<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        value <span class="token operator">=</span> initialValue<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ­¤å¤–ï¼ŒJDK 8å¼€å§‹ï¼Œæä¾›äº†ä¸€ä¸ª<code>sun.misc.Contended</code>æ³¨è§£æ¥è§£å†³ä¼ªå…±äº«é—®é¢˜ï¼ŒåŠ ä¸Šè¿™ä¸ªæ³¨è§£çš„ç±»ä¼šè‡ªåŠ¨è¡¥é½ç¼“å­˜è¡Œã€‚</p><p>ç¨å¾®æ‰¯è¿œäº†ä¸€äº›ï¼Œæˆ‘ä»¬å›åˆ°ä¸Šæ–¹çš„åŠ¨å›¾ã€‚<code>Core0</code>ä¿®æ”¹äº†ç¼“å­˜è¡Œä¸­çš„<code>X</code>ï¼Œæˆ‘ä»¬è¯´å½“å‰æœ€åˆé€‚çš„å¤„ç†åŠæ³•å°±æ˜¯è®©<code>Core1</code>ä¸­çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼Œå¦åˆ™å°±ä¼šå‡ºç°ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ã€‚ä¼ªå…±äº«é—®é¢˜å…¶å®å°±æ˜¯è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜çš„å‰¯ä½œç”¨ã€‚åªä¸è¿‡æœ¬æ–‡ä¸­æˆ‘å•ç‹¬æŠŠè¿™ä¸ªé—®é¢˜åˆ—äº†å‡ºæ¥ã€‚</p><p>ä¸ºäº†è§£å†³ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼ŒCPUå¤©ç„¶æ”¯æŒäº†æ€»çº¿é”çš„åŠŸèƒ½ã€‚</p><h2 id="_3-æ€»çº¿é”" tabindex="-1"><a class="header-anchor" href="#_3-æ€»çº¿é”" aria-hidden="true">#</a> 3. æ€»çº¿é”</h2><p>é¡¾åæ€ä¹‰å°±æ˜¯ï¼Œé”ä½Busæ€»çº¿ã€‚é€šè¿‡å¤„ç†å™¨å‘å‡º<code>lock</code>æŒ‡ä»¤ï¼Œæ€»çº¿æ¥å—åˆ°æŒ‡ä»¤åï¼Œå…¶ä»–å¤„ç†å™¨çš„è¯·æ±‚å°±ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°æ­¤å¤„ç†å™¨æ‰§è¡Œå®Œæˆã€‚è¿™æ ·ï¼Œå¤„ç†å™¨å°±å¯ä»¥ç‹¬å å…±äº«å†…å­˜çš„ä½¿ç”¨ã€‚</p><p>ä½†æ˜¯ï¼Œ<strong>æ€»çº¿é”æœ‰ä¸€ä¸ªéå¸¸å¤§çš„ç¼ºç‚¹ï¼Œä¸€æ—¦æŸä¸ªå¤„ç†å™¨è·å–æ€»çº¿é”ï¼Œå…¶ä»–å¤„ç†å™¨éƒ½åªèƒ½é˜»å¡ç­‰å¾…ï¼Œå¤šå¤„ç†å™¨çš„ä¼˜åŠ¿å°±æ— æ³•å‘æŒ¥</strong>ã€‚</p><p>äºæ˜¯ï¼Œç»è¿‡å‘å±•ã€ä¼˜åŒ–ï¼Œåˆäº§ç”Ÿäº†ç¼“å­˜é”ã€‚</p><h2 id="_4-ç¼“å­˜é”" tabindex="-1"><a class="header-anchor" href="#_4-ç¼“å­˜é”" aria-hidden="true">#</a> 4. ç¼“å­˜é”</h2><p>ç¼“å­˜é”ï¼šä¸éœ€é”å®šæ€»çº¿ï¼Œç»´æŠ¤æœ¬å¤„ç†å™¨å†…éƒ¨ç¼“å­˜å’Œå…¶ä»–å¤„ç†å™¨ç¼“å­˜çš„ä¸€è‡´æ€§ã€‚ç›¸æ¯”æ€»çº¿é”ï¼Œä¼šæé«˜cpuåˆ©ç”¨ç‡ã€‚</p><p>ä½†æ˜¯ç¼“å­˜é”ä¹Ÿä¸æ˜¯ä¸‡èƒ½ï¼Œæœ‰äº›åœºæ™¯å’Œæƒ…å†µä¾ç„¶å¿…é¡»é€šè¿‡æ€»çº¿é”æ‰èƒ½å®Œæˆã€‚</p><p><strong>ç¼“å­˜é”å…¶å®æ˜¯ä¸€ç§å®ç°çš„æ•ˆæœ</strong>ï¼Œå®ƒæ˜¯é€šè¿‡<strong>ç¼“å­˜ä¸€è‡´æ€§åè®®</strong>æ¥å®ç°çš„ï¼Œå¯èƒ½æœ‰çš„è¯»è€…ä¹Ÿå¬è¯´è¿‡<code>Snoopyå—…æ¢åè®®</code>ï¼Œæˆ‘ä¸¾ä¸ªä¾‹å­å¸®åŠ©å¤§å®¶ç†è§£è¿™ä¸‰ä¸ªæ¦‚å¿µã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024358.png" alt="æ€»çº¿é”&amp;ç¼“å­˜é”&amp;å—…æ¢åè®®" loading="lazy"></p><p>å‡å¦‚æ‘é‡Œæœ‰ä¸€ä¸ªå•äººå…¬å•ï¼Œä¸€æ¡èœ¿èœ’å¤§é“ä¸å…¬å•ç›¸è¿ï¼Œå¤§é“æ—è¾¹ä½ç€Aã€Bã€Cã€Då››ä¸ªäººï¼Œæ¯ä¸ªäººè¦ä¸Šå•æ‰€å¿…é¡»ç»è¿‡ä¸»å¹²é“ã€‚</p><p>æˆ‘ä»¬å†è®¾ç½®ä¸€ç‚¹å‰æï¼Œå‡è®¾æ¯ä¸ªäººéƒ½ä¸æƒ³åˆ°äº†å•æ‰€é—¨å£çš„æ—¶å€™æ‰çŸ¥é“å•æ‰€å·²ç»è¢«äººå ç”¨äº†ã€‚</p><p>ä¸ºäº†åˆç†ä½¿ç”¨å•æ‰€ï¼Œä¿è¯æ¯æ¬¡åªæœ‰ä¸€ä¸ªäººè¿›å…¥å•æ‰€ï¼Œå¹¶ä¸”ä¸ä¼šå‡ºç°å…¶ä»–äººåœ¨å•æ‰€é—¨å£ç­‰å¾…çš„æƒ…å†µï¼ŒABCDå››ä¸ªäººèšåœ¨ä¸€èµ·å¼€ä¼šè®¨è®ºï¼Œåå•†å‡ºäº†ä¸€æ¡çº¦å®šã€‚</p><blockquote><p>å½“æœ‰äººå»ä¸Šå•æ‰€çš„æ—¶å€™ï¼Œå…¶ä»–äººåœ¨å®¶è€å®å‘†ç€ï¼Œä¸è¦å»ä¸Šå•æ‰€ï¼</p></blockquote><p>å››ä¸ªäººçº·çº·æ‹ç€è‡ªå·±å¤§è…¿å«ç»ã€‚ä»–ä»¬å•†è®®å‡ºæ¥äº†ä¸€ä¸ªå¬èµ·æ¥ç¡®å®èƒ½è§£å†³é—®é¢˜ï¼Œä½†æ˜¯å®é™…ä¸Šå†…å®¹éå¸¸ç©ºæ´çš„ä¸€ä¸ªåè®®ã€‚</p><p>å› ä¸ºä»–ä»¬ä¸çŸ¥é“ç°åœ¨æœ‰è°æ­£åœ¨å ç”¨å•æ‰€ï¼Œæ›´ä¸çŸ¥é“è°æ­£åœ¨å‰å¾€å•æ‰€çš„è·¯ä¸Šã€‚</p><p>å…¶ä¸­Açµæœºä¸€åŠ¨ï¼Œæƒ³å‡ºäº†ä¸€ä¸ªåŠæ³•ã€‚å¯ä»¥åœ¨æ¯å®¶å’Œä¸»å¹²é“çš„å²”è·¯å£è®¾ç½®ä¸€ä¸ªç›‘æµ‹è®¾å¤‡ï¼Œå½“æœ‰äººä¸Šå•æ‰€ç»è¿‡å²”è·¯å£çš„æ—¶å€™ç›‘æµ‹è®¾å¤‡å°±æé†’å…¶ä»–ä¸‰ä¸ªäººå·²ç»æœ‰äººå»å•æ‰€äº†ï¼Œè€å®åœ¨å®¶ç­‰ç€å§ã€‚</p><p>å¦‚æ­¤ä¸€æ¥ï¼Œå°±è¾¾æˆäº†ä¸€ç§ç»™å•æ‰€æ·»åŠ é”çš„ä¸€ç§æ•ˆæœï¼Œè¿™ç§æ•ˆæœå°±ç›¸å½“äºä¸Šæ–‡æåˆ°çš„ç¼“å­˜é”ã€‚4äººå•†è®®å‡ºæ¥çš„åè®®å°±ç›¸å½“äºç¼“å­˜ä¸€è‡´æ€§åè®®ï¼ŒAæå‡ºæ¥çš„æ–¹æ³•å®ç°äº†åè®®ï¼Œç›¸å½“äºSnoopyå—…æ¢ã€‚</p><blockquote><p>å¦‚æœå¤§å®¶è¯»åˆ°è¿™é‡Œåœ¨æ€è€ƒä¾‹å­ä¸­çš„å•æ‰€ç©¶ç«Ÿè¡¨ç¤ºå†…å­˜è¿˜æ˜¯ç¼“å­˜è¡Œï¼Œæˆ‘åŠå¤§å®¶èµ¶ç´§æ­¢ä½ã€‚åœ¨ç”Ÿæ´»ä¸­æ‰¾åˆ°å’Œè®¡ç®—æœºç§‘å­¦ä¸­éå¸¸è´´åˆ‡çš„ä¾‹å­æ˜¯éå¸¸éå¸¸å›°éš¾çš„ã€‚è¿™ä¸ªä¾‹å­åªæ˜¯ç®€å•è¯´æ˜ä¸€ä¸‹ç¼“å­˜é”å’Œé”å­˜ä¸€è‡´æ€§åè®®ä»¥åŠSnoopyå—…æ¢åè®®ä¹‹é—´çš„å…³ç³»ç½¢äº†ï¼Œä¸è¦æ·±ç©¶ï¼</p></blockquote><p>è‡ªç„¶ï¼Œç¼“å­˜ä¸€è‡´æ€§åè®®å°±æ˜¯æˆ‘ä»¬æ¥ä¸‹æ¥çš„ä¸»è§’äº†ã€‚</p><h2 id="_5-ç¼“å­˜ä¸€è‡´æ€§åè®®" tabindex="-1"><a class="header-anchor" href="#_5-ç¼“å­˜ä¸€è‡´æ€§åè®®" aria-hidden="true">#</a> 5. ç¼“å­˜ä¸€è‡´æ€§åè®®</h2><p>æ¯ä¸ªå¤„ç†å™¨å…±äº«åŒä¸€ä¸ªä¸»å†…å­˜ï¼Œå¹¶ä¸”éƒ½æœ‰è‡ªå·±çš„é«˜é€Ÿç¼“å­˜ã€‚<strong>å¦‚æœå¤šä¸ªå¤„ç†å™¨éƒ½å¯¹åŒä¸€å—ä¸»å†…å­˜åŒºåŸŸè¿›è¡Œæ›´æ”¹ï¼Œå°†å¯¼è‡´å„è‡ªçš„çš„ç¼“å­˜æ•°æ®ä¸ä¸€è‡´</strong>ã€‚é‚£åŒæ­¥åˆ°ä¸»å†…å­˜æ—¶è¯¥ä»¥è°çš„ç¼“å­˜æ•°æ®ä¸ºå‡†å‘¢ï¼Ÿ</p><p>ç¼“å­˜ä¸€è‡´æ€§åè®®å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜æå‡ºçš„ï¼Œè¿™ç±»åè®®æœ‰<code>MSI</code>ã€<code>MESI</code>å’Œ<code>MOSI</code>ç­‰ã€‚</p><p>æˆ‘ä»¬ä»¥åº”ç”¨æœ€å¹¿æ³›çš„<code>MESI</code>ä¸ºä¾‹è¿›è¡Œä»‹ç»ã€‚</p><h3 id="_5-1-mesi" tabindex="-1"><a class="header-anchor" href="#_5-1-mesi" aria-hidden="true">#</a> 5.1. MESI</h3><p><code>MESI</code>æ˜¯<code>Modified</code>ã€<code>Exclusive</code>ã€<code>Shared</code>ã€<code>Invalid</code>å››ä¸ªå•è¯çš„é¦–å­—æ¯ç¼©å†™ï¼Œè¡¨ç¤º<strong>ç¼“å­˜è¡Œ</strong>çš„4ç§çŠ¶æ€ã€‚</p><ul><li>Modified</li></ul><p>ç¼“å­˜è¡Œè¢«å¯¹åº”çš„CPUæ ¸å¿ƒä¿®æ”¹ä¹‹åå°±ä¼šå¤„äº<code>Modified</code>çŠ¶æ€ï¼Œå¹¶ä¸”ä¿è¯è¯¥ç¼“å­˜è¡Œä¸ä¼šå‡ºç°åœ¨ä»»ä½•å…¶ä»–CPUçš„ç¼“å­˜ä¸­ã€‚å³ä½¿æœ‰ï¼Œä¹Ÿæ˜¯<code>Invalid</code>çŠ¶æ€ï¼Œéœ€è¦ä»å†…å­˜æˆ–å…¶ä»–Cacheä¸­é‡æ–°è¯»å–ã€‚</p><p>å› æ­¤ï¼Œå¤„äº<code>Modified</code>çŠ¶æ€çš„ç¼“å­˜è¡Œå¯ä»¥è¯´æ˜¯è¢«ç›¸åº”CPUæ ¸å¿ƒç‹¬å çš„ã€‚ç”±äºè¯¥ç¼“å­˜è¡Œæ‹¥æœ‰è¯¥æ•°æ®çš„å”¯ä¸€æœ€æ–°å‰¯æœ¬ï¼Œå› æ­¤è¯¥ç¼“å­˜è¡Œæœ€ç»ˆè´Ÿè´£å°†å…¶å†™å›å†…å­˜æˆ–å°†å…¶ä¼ é€’ç»™å…¶ä»–CPUã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024404.png" alt="Modifiedçš„ç¼“å­˜è¡Œ" loading="lazy"></p><ul><li>Exclusive</li></ul><p><code>Exclusive</code>çŠ¶æ€å°±éå¸¸å¥½ç†è§£äº†ï¼Œæ„å‘³ç€ç‹¬å ã€æ’ä»–ï¼Œå’Œ<code>Modified</code>çŠ¶æ€éå¸¸ç±»ä¼¼ã€‚å”¯ä¸€ä¸åŒçš„ä¸€ç‚¹å°±æ˜¯è¿™ä¸ªç¼“å­˜è¡Œè¿˜æ²¡æœ‰è¢«CPUæ ¸å¿ƒä¿®æ”¹ï¼Œè¿™ä¹Ÿè¯´æ˜å†…å­˜ä¸­çš„å†…å®¹ä¾ç„¶æ˜¯æœ€æ–°çš„ã€‚å³ä¾¿å¦‚æ­¤ï¼Œä¸€æ—¦æŸä¸ªç¼“å­˜è¡Œå¤„äºè¯¥çŠ¶æ€ï¼Œå°±æ„å‘³ç€å…¶ä»–CPUæ ¸å¿ƒä¸èƒ½æ‹¥æœ‰è¯¥ç¼“å­˜è¡Œçš„å‰¯æœ¬ã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024410.png" alt="Exclusiveç¼“å­˜è¡Œ" loading="lazy"></p><ul><li>Shared</li></ul><p>å¤„äº<code>Shared</code>çŠ¶æ€çš„ç¼“å­˜è¡Œæ„å‘³ç€åŒæ—¶å‡ºç°åœ¨äº†ä¸€ä¸ªæˆ–å¤šä¸ªCPU Cacheä¸­ï¼Œä¸”å¤šä¸ªCPU Cacheçš„ç¼“å­˜è¡Œå’Œå†…å­˜ä¸­çš„æ•°æ®ä¸€è‡´ã€‚CPUæ ¸å¿ƒä¸èƒ½åœ¨æœªä¸å…¶ä»–æ ¸å¿ƒâ€œåå•†â€çš„æƒ…å†µä¸‹ï¼Œä¿®æ”¹å…¶Cacheä¸­çš„è¯¥ç¼“å­˜è¡Œã€‚è‡³äºä»€ä¹ˆæ˜¯â€œåå•†â€ï¼Œä¸‹æ–‡ä¼šè®²åˆ°ã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024416.png" alt="Sharedç¼“å­˜è¡Œ" loading="lazy"></p><ul><li>Invalid</li></ul><p>å¤„äº<code>Invalid</code>çŠ¶æ€çš„ç¼“å­˜è¡Œä¸åŒ…å«ä»»ä½•æ•°æ®ï¼Œåªæ˜¯è¢«æ‰“ä¸Šäº†<code>Invalid</code>çŠ¶æ€çš„æ ‡ç­¾è€Œå·²ã€‚å…¶ä»–CPUä¿®æ”¹äº†ç¼“å­˜è¡Œï¼Œå°±ä¼šå¯¼è‡´æœ¬CPUä¸­çš„è¯¥ç¼“å­˜è¡Œå¤±æ•ˆä¸º<code>Invalid</code>çŠ¶æ€ã€‚å½“æœ‰æ–°æ•°æ®è¢«æ”¾å…¥Cacheä¸­æ—¶ï¼Œä¼šè¢«ä¼˜å…ˆæ”¾å…¥<code>Invalid</code>çŠ¶æ€çš„ç¼“å­˜è¡Œä¸­ï¼Œé¿å…ç½®æ¢å‡ºå…¶ä»–æœ‰ç”¨çš„ç¼“å­˜å¯¼è‡´Cache Missã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024421.png" alt="Invalidç¼“å­˜è¡Œ" loading="lazy"></p><p>ä»¥ä¸Š4ç§çŠ¶æ€ä¹‹é—´çš„è·ƒè¿ç¦»ä¸å¼€å„ä¸ªCPUæ ¸å¿ƒä¹‹é—´çš„åä½œï¼Œæ¯”å¦‚æŸä¸ªæ•°æ®è¢«åŒæ—¶ç¼“å­˜åœ¨å¤šä¸ªCPUæ ¸å¿ƒçš„Cacheä¸­ï¼Œæ­¤æ—¶è¿™äº›ç¼“å­˜è¡Œçš„çŠ¶æ€æ˜¯<code>Shared</code>ï¼Œå‡å¦‚<code>Core0</code>å¯¹ç¼“å­˜è¡Œåšäº†writeæ“ä½œï¼Œä¸ºäº†é¿å…ç¼“å­˜æ•°æ®çš„ä¸ä¸€è‡´æ€§ï¼Œå…¶ä»–CPUæ ¸å¿ƒéœ€è¦å°†å¯¹åº”çš„ç¼“å­˜è¡ŒçŠ¶æ€è®¾ç½®ä¸º<code>Invalid</code>çŠ¶æ€ã€‚é‚£ä¹ˆå…¶ä»–CPUæ ¸å¿ƒæ˜¯æ€ä¹ˆçŸ¥é“<code>Core0</code>ä¿®æ”¹äº†ç¼“å­˜è¡Œå‘¢ï¼Ÿæ¢ä¸ªé—®æ³•ï¼Œ<code>Core0</code>æ€ä¹ˆè®©å…¶ä»–æ ¸å¿ƒçŸ¥é“è‡ªå·±ä¿®æ”¹äº†ç¼“å­˜è¡Œå‘¢ï¼Ÿ</p><p>äººæœ‰äººè¨€ï¼Œå…½æœ‰å…½è¯­ã€‚CPUæ ¸å¿ƒä¹‹é—´çš„æ²Ÿé€šä¹Ÿæœ‰è‡ªå·±çš„ä¸€å¥—â€œé»‘è¯â€ï¼Œç§°ä¸º<strong>ç¼“å­˜ä¸€è‡´æ€§æ¶ˆæ¯</strong>ã€‚</p><h3 id="_5-2-cpuä¹‹é—´çš„-é»‘è¯" tabindex="-1"><a class="header-anchor" href="#_5-2-cpuä¹‹é—´çš„-é»‘è¯" aria-hidden="true">#</a> 5.2. CPUä¹‹é—´çš„â€œé»‘è¯â€</h3><p>æ¶ˆæ¯åˆ†ä¸ºè¯·æ±‚å’Œå“åº”ä¸¤ç±»ã€‚</p><p>å¤„ç†å™¨åœ¨è¿›è¡Œæ•°æ®è¯»å†™çš„æ—¶å€™ä¼šå¾€æ€»çº¿ï¼ˆBusï¼‰ä¸­å‘è¯·æ±‚æ¶ˆæ¯ï¼ŒåŒæ—¶æ¯ä¸ªå¤„ç†å™¨æ ¸å¿ƒè¿˜ä¼šå—…æ¢ï¼ˆSnoopï¼‰æ€»çº¿ä¸­ç”±å…¶ä»–å¤„ç†å™¨å‘å‡ºçš„è¯·æ±‚æ¶ˆæ¯å¹¶åœ¨ä¸€å®šæ¡ä»¶ä¸‹å¾€æ€»çº¿ä¸­å›å¤å“åº”æ¶ˆæ¯ã€‚</p><ul><li>Read</li></ul><p><code>Read</code>æ¶ˆæ¯è¡¨ç¤ºè¦è¯»å–æŸä¸ªç¼“å­˜è¡Œï¼ŒåŒæ—¶ä¼šæºå¸¦ç›®æ ‡ç¼“å­˜è¡Œå¯¹åº”çš„ç‰©ç†åœ°å€ã€‚</p><ul><li>Read Response</li></ul><p>æ˜¯å¯¹<code>Read</code>æ¶ˆæ¯çš„åé¦ˆï¼Œåé¦ˆçš„å†…å®¹å°±æ˜¯å‘<code>é€Read</code>æ¶ˆæ¯çš„CPUæ ¸å¿ƒè¯·æ±‚çš„ç›®æ ‡ç¼“å­˜è¡Œã€‚<code>Read Response</code>å¯èƒ½æ¥è‡ªäºå†…å­˜ï¼Œä¹Ÿå¯èƒ½æ¥è‡ªå…¶ä»–CPUæ ¸å¿ƒã€‚</p><p>æ¯”å¦‚ï¼Œå¦‚æœè¢«è¯·æ±‚çš„ç›®æ ‡ç¼“å­˜è¡Œä¸å­˜åœ¨äºä»»ä½•CPU Cacheä¸­ï¼Œé‚£ä¹ˆåªèƒ½ä»å†…å­˜ä¸­è·å–ï¼›å¦‚æœè¢«è¯·æ±‚çš„ç›®æ ‡ç¼“å­˜è¡Œæ°å¥½è¢«å…¶ä¸­ä¸€ä¸ªCPUä¿®æ”¹ï¼Œæ­¤æ—¶è¯¥ç¼“å­˜è¡Œä¸º<code>Modified</code>çŠ¶æ€ï¼Œæ„å‘³ç€è¯¥ç¼“å­˜è¡Œç›®å‰æ˜¯æœ€æ–°æ•°æ®ï¼Œé‚£ä¹ˆç†åº”è®©å…¶ä»–åŒæ ·éœ€è¦è¯¥ç¼“å­˜è¡Œçš„CPUæ ¸å¿ƒè·å–åˆ°è¯¥æœ€æ–°æ•°æ®ï¼Œæ›´è¿›ä¸€æ­¥ï¼Œè‡ªç„¶ç†åº”ç”±è¯¥CPUæ ¸å¿ƒæŠŠè¯¥ç¼“å­˜è¡Œçš„å†…å®¹åé¦ˆç»™å‘å‡º<code>Read</code>æ¶ˆæ¯çš„CPUæ ¸å¿ƒã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024427.gif" alt="Read Response" loading="lazy"></p><ul><li>Invalidate</li></ul><p><code>Invalidate</code>çš„å«ä¹‰æ˜¯ä½¿æŸä¸ªç¼“å­˜è¡Œå¤±æ•ˆï¼Œæ‹¥æœ‰è¯¥ç¼“å­˜è¡Œçš„å…¶ä»–CPUæ ¸å¿ƒéœ€è¦åˆ é™¤è¯¥ç¼“å­˜è¡Œä¸­çš„æ•°æ®ï¼Œå¹¶å¯¹å‘å‡º<code>Invalidate</code>æ¶ˆæ¯çš„æ ¸å¿ƒåšå‡ºåé¦ˆã€‚</p><ul><li>Invalidate Acknowledge</li></ul><p>è¿™å°±æ˜¯ä¸Šé¢æåˆ°çš„<code>Invalidate</code>æ¶ˆæ¯çš„åé¦ˆï¼Œæ„å‘³ç€å‘å‡ºæ­¤æ¶ˆæ¯çš„CPUæ ¸å¿ƒå·²ç»å°†<code>Invalidate</code>æ¶ˆæ¯çš„ç›®æ ‡ç¼“å­˜è¡Œä¸­çš„æ•°æ®æ¸…é™¤ã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024434.gif" alt="Invalidate" loading="lazy"></p><p>å¦‚æœæœ‰å¤šä¸ªCPUåŒæ—¶å‘å‡º<code>Invalidate</code>æ¶ˆæ¯æ€ä¹ˆåŠï¼Ÿç­”æ¡ˆæ˜¯æ€»çº¿è£å†³ã€‚é¦–å…ˆå ç”¨æ¶ˆæ¯æ€»çº¿çš„CPUæ ¸å¿ƒè·èƒœï¼Œå…¶ä»–æ ¸å¿ƒåªèƒ½ä¹–ä¹–æ¸…ç©ºè‡ªå·±çš„ç¼“å­˜è¡Œï¼Œå¹¶å‘å…¶å‘å‡º<code>Invalidate Acknowledge</code>åé¦ˆã€‚</p><ul><li>Read Invalidate</li></ul><p><code>Read Invalidate</code>ç›¸å½“äº<code>Read</code> + <code>Invalidate</code>ï¼Œæ—¢è¦è¯»å–æŸä¸ªç¼“å­˜è¡Œä¿¡æ¯ï¼Œåˆè¦è®©å±äºå…¶ä»–CPUæ ¸å¿ƒçš„æ­¤ç¼“å­˜è¡Œå¤±æ•ˆã€‚åŒæ ·ï¼Œ<code>Read Invalidate</code>ä¹Ÿéœ€è¦æ”¶åˆ°åé¦ˆï¼Œåªä¸è¿‡æ­¤åé¦ˆæ—¢åŒ…å«1æ¡<code>Read Response</code>ï¼ŒåˆåŒ…å«å¤šæ¡ï¼ˆå¦‚æœå…¶ä»–CPUæ ¸å¿ƒä¹Ÿæ‹¥æœ‰ç›®æ ‡ç¼“å­˜è¡Œçš„è¯ï¼‰<code>Invalidate Acknowledge</code>ã€‚</p><ul><li>Writeback</li></ul><p><code>Writeback</code>æ¶ˆæ¯åŒ…å«è¦å†™å›å†…å­˜çš„åœ°å€å’Œæ•°æ®ï¼Œé€šå¸¸æŒ‡çš„æ˜¯<code>Modified</code>çŠ¶æ€çš„æ•°æ®ï¼Œè¿™æ ·Cacheå°±å¯ä»¥æ ¹æ®éœ€è¦å¼¹å‡ºå¤„äº<code>Modified</code>çŠ¶æ€çš„ç¼“å­˜è¡Œï¼Œä»¥ä¾¿ä¸ºå…¶ä»–æ•°æ®è…¾å‡ºç©ºé—´ã€‚</p><p>è¿™ä¿©æ¶ˆæ¯å¾ˆç®€å•ï¼Œå°±ä¸ç”»å›¾æµªè´¹ä½ ä»¬çš„æµé‡äº†ã€‚ã€‚ã€‚</p><h3 id="_5-3-mesiçŠ¶æ€è·ƒè¿ç¤ºä¾‹" tabindex="-1"><a class="header-anchor" href="#_5-3-mesiçŠ¶æ€è·ƒè¿ç¤ºä¾‹" aria-hidden="true">#</a> 5.3. MESIçŠ¶æ€è·ƒè¿ç¤ºä¾‹</h3><p>CPUä¹‹é—´é€šè¿‡ç¼“å­˜ä¸€è‡´æ€§æ¶ˆæ¯çš„ä¼ é€’ï¼Œæ‰æœ‰äº†ç¼“å­˜è¡Œåœ¨<code>MESI</code>å››ç§çŠ¶æ€ä¹‹é—´çš„è·ƒè¿ã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024440.png" alt="img" loading="lazy"></p><p>å¦‚ä¸Šå›¾ï¼Œæ¯ä¸¤ä¸ªçŠ¶æ€ä¹‹é—´éƒ½å¯èƒ½ä¼šå‘ç”ŸçŠ¶æ€è¶Šè¿ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å¾ˆå¤æ‚ï¼Ÿ</p><p>å¦‚æœä¹‹å‰çš„å†…å®¹æˆ‘ç»™ä½ è§£é‡Šåœ°å¾ˆæ¸…æ¥šçš„è¯ï¼Œå°±å¾ˆå®¹æ˜“æƒ³æ˜ç™½æ¯ä¸ªçŠ¶æ€ä¹‹é—´çš„è·ƒè¿åœºæ™¯äº†ã€‚ä¸ºäº†ä¸å½±å“æ¥ä¸‹æ¥çš„è®²è§£ï¼Œæˆ‘æŠŠæ¯ç§åœºæ™¯è§£é‡Šæ”¾åœ¨äº†æ–‡ç« æœ€åï¼ˆè§é™„å½•1ï¼‰ï¼Œéœ€è¦çš„è¯»è€…è¯»å®Œæ–‡ç« ä¹‹åå¯ä»¥ç¿»é˜…ä¸€ä¸‹ï¼ˆå³ä½¿ä¸çœ‹ä¹Ÿä¸ä¼šå½±å“æ¥ä¸‹æ¥çš„é˜…è¯»å“¦ï¼‰ã€‚</p><p>è¿˜æœ‰ä¸€ä¸ªåœ¨çº¿çš„ç½‘ç«™å¯ä»¥å¸®åŠ©ä½ æ›´å¥½åœ°ç†è§£MESIåè®®ï¼ˆè§é™„å½•2ï¼‰ï¼Œä½ å¯ä»¥ç«™åœ¨CPUçš„è§’åº¦å‘å‡ºæŒ‡ä»¤ï¼Œç½‘ç«™ä»¥åŠ¨æ€æ–¹å¼å±•ç¤ºç¼“å­˜è¡Œçš„çŠ¶æ€å˜æ¢ï¼Œå¼ºçƒˆå»ºè®®é˜…è¯»å®Œæ–‡ç« ä¹‹åå¤§å®¶è¯•ä¸€ä¸‹ã€‚</p><p>æˆªè‡³ç›®å‰ï¼Œæ–‡ç« éƒ½æ˜¯å›´ç»•Cacheå±•å¼€çš„ï¼Œé«˜é€Ÿç¼“å­˜çš„å¼•å…¥æå¤§åœ°æé«˜äº†è®¡ç®—æœºçš„æ•´ä½“è¿è¡Œæ•ˆç‡ã€‚ä½†åœ¨æŸäº›ç‰¹æ®Šæƒ…å†µä¸‹ï¼ŒCPUçš„æ€§èƒ½è¡¨ç°å´æ˜¯éå¸¸ç³Ÿç³•ã€‚</p><h2 id="_6-ä¸èƒ½è®©cpué—²ç€" tabindex="-1"><a class="header-anchor" href="#_6-ä¸èƒ½è®©cpué—²ç€" aria-hidden="true">#</a> 6. ä¸èƒ½è®©CPUé—²ç€</h2><p>è€ƒè™‘è¿™ä¹ˆä¸€ä¸ªåœºæ™¯ï¼Œ<code>CPU 0</code> å’Œ<code>CPU 1</code> åŒæ—¶æ‹¥æœ‰æŸä¸ªç¼“å­˜è¡Œï¼Œä¸¤ä¸ªç¼“å­˜è¡Œéƒ½å¤„äº<code>Shared</code>çŠ¶æ€ï¼Œ<code>CPU 0</code>æƒ³å¯¹è‡ªå·±çš„ç¼“å­˜è¡Œæ‰§è¡Œwriteæ“ä½œï¼Œå¿…é¡»å…ˆå‘é€<code>Invalidate</code>æ¶ˆæ¯è®©<code>CPU 1</code>ä¸­çš„ç¼“å­˜è¡Œå¤±æ•ˆã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024445.gif" alt="CPUé—²ä¸‹æ¥äº†" loading="lazy"></p><p>ç”±äº<code>CPU 0</code>å¿…é¡»ç­‰åˆ°<code>CPU 1</code>åé¦ˆäº†<code>Invalidate Acknowledge</code>ä¹‹åæ‰èƒ½ç¡®ä¿è‡ªå·±å¯ä»¥æ“ä½œç¼“å­˜è¡Œï¼Œæ‰€ä»¥ä»å‘å‡º<code>Invalidate</code>ç›´åˆ°æ”¶åˆ°<code>Invalidate Acknowledge</code>çš„è¿™æ®µæ—¶é—´ï¼Œ<code>CPU 0</code>ä¸€ç›´å¤„äºé—²ç½®çŠ¶æ€ã€‚</p><p>CPUæ˜¯ä½•ç­‰å®è´µçš„èµ„æºï¼Œè®©å®ƒé—²ç€æ˜¯ä¸å¯èƒ½çš„ï¼Œç»å¯¹ä¸å¯èƒ½çš„ï¼</p><p>ç¡¬ä»¶å·¥ç¨‹å¸ˆä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå¼•å…¥äº†<code>Store Buffers</code>ã€‚</p><h3 id="_6-1-å¼•å…¥store-buffers" tabindex="-1"><a class="header-anchor" href="#_6-1-å¼•å…¥store-buffers" aria-hidden="true">#</a> 6.1. å¼•å…¥Store Buffers</h3><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024452.png" alt="img" loading="lazy"></p><p>å·¥ç¨‹å¸ˆåœ¨CPUå’ŒCacheä¹‹é—´æ·»åŠ äº†ä¸€ä¸ªä¸­é—´å±‚â€”â€”<code>Store Buffer</code>ã€‚å½“<code>CPU 0</code>æƒ³æ‰§è¡ŒwriteæŒ‡ä»¤æ—¶ï¼Œå…ˆæŠŠæƒ³è¦writeçš„å€¼å†™å…¥åˆ°<code>Store Buffer</code>ä¸­ï¼Œç„¶åå†ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡ï¼Œæ— éœ€å‚»å‚»åœ°ç­‰å¾…<code>CPU 1</code>ã€‚ç›´åˆ°<code>CPU 1</code>ä¼ å›åé¦ˆä¹‹åï¼Œ<code>CPU 0</code>å†å°†<code>Store Buffer</code>ä¸­çš„æœ€æ–°å€¼å†™å…¥åˆ°ç¼“å­˜è¡Œä¸­ã€‚</p><p>è®¡ç®—æœºçš„å‘å±•å°±æ˜¯ä¸æ–­æŒ–å‘ã€å¡«å‘çš„è¿‡ç¨‹ã€‚<code>Store Buffers</code>çš„å¼•å…¥è§£å†³äº†CPUé—²ç½®çš„é—®é¢˜ï¼Œå¦‚æœäº‹æƒ…å‘å±•åˆ°ç°åœ¨å°±å®Œç¾äº†è¯¥æœ‰å¤šå¥½ï¼Œç„¶è€Œåˆå¼•å‡ºäº†3ä¸ªæ–°é—®é¢˜ã€‚</p><h3 id="_6-2-store-bufferså¼•èµ·çš„é—®é¢˜1" tabindex="-1"><a class="header-anchor" href="#_6-2-store-bufferså¼•èµ·çš„é—®é¢˜1" aria-hidden="true">#</a> 6.2. Store Bufferså¼•èµ·çš„é—®é¢˜1</h3><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024458.png" alt="img" loading="lazy"></p><p>çœ‹ä¸€ä¸‹ä¸Šå›¾å·¦ä¾§çš„ä»£ç ï¼Œå…¶ä¸­<code>a</code>å’Œ<code>b</code>çš„åˆå§‹å€¼ä¸º0ï¼Œåœ¨å¤§å¤šæ•°æ—¶å€™ï¼Œæœ€åçš„æ–­è¨€ä¼šä¸ºTrueã€‚</p><p>ä¹‹æ‰€ä»¥è¯´å¤§å¤šæ•°æ—¶å€™ï¼Œå› ä¸ºå·¦ä¾§çš„ä»£ç åœ¨æŸä¸ªåœºæ™¯ä¸‹å¯èƒ½ä¼šå‡ºç°ä¸ç¬¦åˆæˆ‘ä»¬é¢„æœŸçš„æƒ…å†µï¼ˆæ–­è¨€ä¸ºFalseï¼‰ã€‚å¦‚æœè¦è¯æ˜ï¼Œæˆ‘ä»¬åªéœ€è¦ä¸¾å‡ºä¸€ä¸ªåä¾‹å³å¯ï¼Œå› æ­¤æˆ‘ä»¬è¿›ä¸€æ­¥å‡è®¾å«æœ‰å˜é‡<code>a</code>çš„ç¼“å­˜è¡Œå·²ç»å­˜åœ¨äº<code>CPU 1</code>çš„Cacheä¸­ï¼Œå«æœ‰å˜é‡<code>b</code>çš„ç¼“å­˜è¡Œå·²ç»å­˜åœ¨äº<code>CPU 0</code>çš„Cacheä¸­ã€‚</p><p>ä¸‹é¢æˆ‘ä»¬æ ¹æ®å¼•å…¥<code>Store Buffers</code>ä¹‹åçš„CPUæ¶æ„æ¥æ‰§è¡Œä¸Šé¢çš„ä»£ç ï¼Œ<code>CPU 0</code> <code>å’ŒCPU 1</code> çš„æ“ä½œé¡ºåºå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024504.png" alt="img" loading="lazy"></p><ol><li>CPU 0 æ‰§è¡Œ <code>a = 1</code>;</li><li>CPU 0 é¦–å…ˆä»è‡ªå·±çš„Cacheä¸­æŸ¥æ‰¾<code>a</code>ï¼Œå‘ç°æ²¡æœ‰ï¼›</li><li>CPU 0 å‘é€<code>Read Invalidate</code>æ¶ˆæ¯æ¥è·å–å«æœ‰<code>a</code>çš„ç¼“å­˜è¡Œï¼Œå¹¶é€šçŸ¥å…¶ä»–CPUï¼Œâ€œè€å­è¦ç”¨ï¼Œä½ ä»¬éƒ½ç»™æˆ‘é”€æ¯ï¼â€ï¼›</li><li>CPU 0 åœ¨<code>Store Buffer</code>ä¸­è®°å½•ä¸‹è‡ªå·±æƒ³èµ‹ç»™<code>a</code>çš„å€¼ï¼Œå³<code>a = 1</code>ã€‚æ­¤æ—¶CPU 0å¹¶ä¸ä¼šé˜»å¡ï¼Œä¼šç»§ç»­å‘ä¸‹æ‰§è¡Œï¼Œä½†æ˜¯åœ¨æ—¶é—´çº¿çš„å‘å±•ä¸Šï¼Œç´§æ¥ç€æ˜¯CPU 1çš„æ“ä½œï¼Œè§ç¬¬5æ­¥ï¼›</li><li>CPU 1æ”¶åˆ°æ¥è‡ªCPU 0çš„<code>Read Invalidate</code>æ¶ˆæ¯ï¼Œäºæ˜¯æŠŠè‡ªå·±åŒ…å«<code>a</code>çš„ç¼“å­˜è¡Œè¿”å›ç»™CPU 0ï¼Œå¹¶ä¸”æŠŠè‡ªå·±çš„ç¼“å­˜è¡ŒçŠ¶æ€è®¾ç½®ä¸º<code>Invalid</code>ï¼›</li><li>CPU 0 å¼€å§‹æ‰§è¡Œ<code>b = a + 1</code>ï¼›</li><li>CPU 0 æ”¶åˆ°æ¥è‡ªCPU 1 çš„ç¼“å­˜è¡Œï¼Œå¹¶æ”¾åˆ°è‡ªå·±çš„ç¼“å­˜è¡Œä¸­ï¼Œå…¶ä¸­<code>a</code>çš„å€¼ä¸º0ï¼›æ­¤æ—¶CPU 0 çš„ç¼“å­˜è¡Œä¸­çš„<code>a</code>å’Œ<code>b</code>çš„çŠ¶æ€éƒ½æ˜¯<code>Exclusive</code>ï¼Œå› ä¸ºè¿™äº›ç¼“å­˜è¡Œéƒ½ç”±CPU 0 ç‹¬å ï¼›</li><li>CPU 0 ä»ç¼“å­˜è¡Œä¸­è¯»å–<code>a</code>ï¼Œæ­¤æ—¶å€¼ä¸º0ï¼›</li><li>CPU 0 æ ¹æ®è‡ªå·±ä¹‹å‰åœ¨<code>Store Buffer</code>ä¸­å­˜æ”¾çš„<code>a = 1</code>æ¥æ›´æ–°è‡ªå·±Cacheä¸­çš„<code>a</code>ï¼Œè®¾ç½®ä¸º1ï¼›</li><li>CPU 0 åœ¨ç¬¬8æ­¥è·å–çš„<code>a</code>å€¼çš„åŸºç¡€ä¸Š<code>+ 1</code>ï¼ˆè¿™ä¸€æ­¥ä¸éœ€è¦é‡æ–°ä»ç¼“å­˜è¡Œä¸­è¯»å–æ•°æ®ï¼Œå› ä¸ºè¯»å–çš„åŠ¨ä½œåœ¨ç¬¬8æ­¥ä¸­å·²ç»åšäº†ï¼‰ï¼Œå¹¶æ›´æ–°è‡ªå·±ç¼“å­˜è¡Œä¸­çš„<code>b</code>ï¼›æ­¤æ—¶åŒ…å«<code>b</code>çš„ç¼“å­˜è¡Œçš„çŠ¶æ€<code>ä¸ºModified</code>ï¼›</li><li>CPU 0 æ‰§è¡Œæ–­è¨€æ“ä½œï¼Œå‘ç°æ–­è¨€ä¸ºFalseã€‚</li></ol><p>å†ç»™å¤§å®¶è¡¥å……ä¸€ä¸ªåŠ¨å›¾ï¼š</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024509.gif" alt="img" loading="lazy"></p><p>è¿™ç¡®å®æ˜¯ä¸€ä»¶éå¸¸è¿åç›´è§‰çš„äº‹æƒ…ï¼Œæˆ‘ä»¬æœ¬æ¥ä»¥ä¸ºCPUå°±æ˜¯å®Œå…¨æŒ‰ç…§ä»£ç çš„é¡ºåºæ‰§è¡Œçš„ï¼ˆè‡³å°‘æœ€ç»ˆç»“æœåº”è¯¥è¡¨ç°åœ°åƒCPUæ˜¯å®Œå…¨æŒ‰ç…§ä»£ç çš„é¡ºåºæ‰§è¡Œçš„ä¸€æ ·ï¼‰ï¼Œæˆ‘ä»¬è®¤ä¸º<code>b</code>çš„æœ€ç»ˆç»“æœå°±åº”è¯¥æ˜¯2ã€‚</p><p>å‡ºç°è¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯<code>CPU 0</code> è¿è¡Œè¿‡ç¨‹ä¸­å‡ºç°äº†<code>a</code>çš„ä¸¤ä»½æ•°æ®æ‹·è´ï¼Œä¸€ä»½æ˜¯åœ¨<code>Store Buffer</code>ä¸­ï¼Œä¸€ä»½æ˜¯åœ¨Cacheä¸­ã€‚</p><blockquote><p>æ³¨æ„ï¼Œè¿™é‡Œè™½ç„¶è¡¨ç°å‡ºæ¥çš„ç»“æœæ˜¯CPUæœªå®Œå…¨æŒ‰ç…§ä»£ç çš„é¡ºåºæ‰§è¡Œï¼Œä½†è¿™<strong>å¹¶ä¸æ˜¯CPUä¹±åºæ‰§è¡Œ</strong>ï¼Œå› ä¸º<code>b</code>å’Œ<code>a</code>ä¹‹é—´å­˜åœ¨ä¾èµ–å…³ç³»ï¼ŒCPUä¸å¯èƒ½ä¼šä¹±åºæ‰§è¡Œã€‚</p></blockquote><p>ä¸ºäº†ä¸è®©è½¯ä»¶å·¥ç¨‹å¸ˆç–¯æ‰ï¼Œç»§ç»­ä¿æŒè½¯ä»¶ä»£ç çš„ç›´è§‚æ€§ï¼Œç¡¬ä»¶å·¥ç¨‹å¸ˆåˆå¼•å…¥äº†<code>Store Forwarding</code>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><h3 id="_6-3-å¼•å…¥store-forwarding" tabindex="-1"><a class="header-anchor" href="#_6-3-å¼•å…¥store-forwarding" aria-hidden="true">#</a> 6.3. å¼•å…¥Store Forwarding</h3><p>æ¯ä¸ªCPUåœ¨æ‰§è¡Œæ•°æ®åŠ è½½æ“ä½œæ—¶éƒ½ç›´æ¥ä½¿ç”¨<code>Store Buffer</code>ä¸­çš„å†…å®¹ï¼Œè€Œæ— éœ€ä»Cacheä¸­è·å–ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024513.png" alt="img" loading="lazy"></p><p>è¯·æ³¨æ„ä¸Šå›¾å’ŒåŸæ¥å›¾ç‰‡çš„åŒºåˆ«ï¼Œä¸Šå›¾ä¸­çš„<code>Store Buffer</code>ä¸­çš„æ•°æ®å¯ä»¥ç›´æ¥è¢«CPUè¯»å–ã€‚å¯¹åº”åˆ°ä¸Šé¢çš„<code>CPU 0</code> çš„æ“ä½œæ­¥éª¤ï¼Œå°±æ˜¯ç¬¬8æ­¥ç›´æ¥ä»<code>Store Buffer</code>ä¸­è¯»å–æœ€æ–°çš„<code>a</code>ï¼Œè€Œä¸æ˜¯ä»Cacheä¸­è¯»å–ï¼Œè¿™æ ·æ•´ä¸ªç¨‹åºçš„æœ€ç»ˆæ–­è¨€ç»“æœå°±æ˜¯Trueï¼</p><p>æ€»ä¹‹ï¼Œå¼•å‘çš„ç¬¬1ä¸ªé—®é¢˜ï¼Œç¡¬ä»¶å·¥ç¨‹å¸ˆé€šè¿‡å¼•å…¥<code>Store Forwarding</code>ä¸ºæˆ‘ä»¬è§£å†³äº†ã€‚</p><h3 id="_6-4-store-bufferså¼•èµ·çš„é—®é¢˜2" tabindex="-1"><a class="header-anchor" href="#_6-4-store-bufferså¼•èµ·çš„é—®é¢˜2" aria-hidden="true">#</a> 6.4. Store Bufferså¼•èµ·çš„é—®é¢˜2</h3><p>åœ¨å¤šä¸ªCPUå¹¶å‘å¤„ç†æƒ…å†µä¸‹ä¹Ÿå¯èƒ½ä¼šå¯¼è‡´ä»£ç è¿è¡Œå‡ºç°é—®é¢˜ã€‚</p><p>åŒæ ·ä¹Ÿæ˜¯ä¸¾ä¸€ä¸ªæç«¯ä¸€ç‚¹çš„ä¾‹å­ã€‚è§ä¸‹å›¾å·¦ä¾§çš„ä»£ç ï¼Œå…¶ä¸­<code>a</code>å’Œ<code>b</code>çš„åˆå§‹å€¼ä¸º0ï¼Œè¿›ä¸€æ­¥å‡è®¾å«æœ‰å˜é‡<code>a</code>çš„ç¼“å­˜è¡Œå·²ç»å­˜åœ¨äº<code>CPU 1</code>çš„Cacheä¸­ï¼Œå«æœ‰å˜é‡<code>b</code>çš„ç¼“å­˜è¡Œå·²ç»å­˜åœ¨äº<code>CPU 0</code>çš„Cacheä¸­ã€‚<code>CPU 0</code> æ‰§è¡Œ<code>foo</code>æ–¹æ³•ï¼Œ<code>CPU 1</code> æ‰§è¡Œ<code>bar</code>æ–¹æ³•ã€‚æ­£å¸¸æƒ…å†µä¸‹ï¼Œ<code>bar</code>æ–¹æ³•ä¸­çš„æ–­è¨€ç»“æœåº”è¯¥ä¸ºTrueã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024518.png" alt="img" loading="lazy"></p><p>ç„¶è€Œï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸‹å›¾ä¸­çš„æ‰§è¡Œé¡ºåºæ“ä½œä¸€éä¹‹åï¼Œæ–­è¨€å´æ˜¯Falseï¼</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024523.png" alt="img" loading="lazy"></p><ol><li>CPU 0 æ‰§è¡Œ<code>a = 1</code>ï¼Œé¦–å…ˆä»è‡ªå·±çš„CacheæŸ¥æ‰¾å•Šï¼Œå‘ç°æ²¡æœ‰ï¼›</li><li>CPU 0 å°†<code>a</code>çš„æ–°å€¼<code>1</code>å†™å…¥åˆ°è‡ªå·±çš„<code>Store Buffer</code>ä¸­ï¼›</li><li>CPU 0 å‘é€<code>Read Invalidate</code>æ¶ˆæ¯ï¼ˆä»å‘å‡ºè¿™ä¸ªæ¶ˆæ¯åˆ°CPU 1 æ¥æ”¶åˆ°ï¼ŒæœŸé—´åˆè¿è¡Œäº†éå¸¸å¤šçš„æ­¥éª¤ï¼Œè§ä¸‹æ–¹GIFå›¾ï¼‰ï¼›</li><li>CPU 1 æ‰§è¡Œ<code>while (b == 0) continue</code>ï¼Œå‘ç°<code>b</code>ä¸åœ¨è‡ªå·±çš„<code>Cache</code>ä¸­ï¼Œäºæ˜¯å‘é€<code>Read</code>æ¶ˆæ¯ï¼›</li><li>CPU 0 æ‰§è¡Œ<code>b = 1</code>ï¼Œç”±äº<code>b</code>å·²ç»å­˜åœ¨äºè‡ªå·±çš„Cacheä¸­äº†ï¼Œæ‰€ä»¥ç›´æ¥å°†Cacheä¸­çš„<code>b</code>ä¿®æ”¹ä¸º<code>1</code>ï¼Œå¹¶ä¿®æ”¹åŒ…å«<code>b</code>çš„ç¼“å­˜è¡Œçš„çŠ¶æ€ä¸º<code>Modified</code>ï¼›</li><li>CPU 0 æ”¶åˆ°æ¥è‡ªç¬¬4æ­¥CPU 1 å‘å‡ºçš„<code>Read</code>æ¶ˆæ¯ï¼Œç”±äºå½“å‰è‡ªå·±æ‹¥æœ‰çš„<code>b</code>æ˜¯æœ€æ–°ç‰ˆæœ¬çš„ï¼Œæ‰€ä»¥CPU 0 æŠŠå«æœ‰<code>b</code>çš„ç¼“å­˜è¡Œè¿”å›ç»™CPU 1ï¼ŒåŒæ—¶ä¿®æ”¹è‡ªå·±çš„ç¼“å­˜è¡ŒçŠ¶æ€ä¸º<code>Shared</code>ï¼›</li><li>CPU 1 æ”¶åˆ°æ¥è‡ªCPU 0 çš„<code>b</code>ç¼“å­˜è¡Œæ•°æ®ï¼Œæ”¾åˆ°è‡ªå·±çš„Cacheä¸­ï¼Œå¹¶è®¾ç½®ä¸º<code>Shared</code>çŠ¶æ€ï¼›</li><li>CPU 1 ç»“æŸ<code>while</code>å¾ªç¯ï¼Œå› ä¸ºæ­¤æ—¶çš„<code>b</code>å€¼å·²ç»æ˜¯<code>1</code>äº†ï¼›</li><li>CPU 1 æ‰§è¡Œ<code>assert(a == 1)</code>ï¼Œç”±äºCacheä¸­çš„<code>a</code>å€¼æ˜¯<code>0</code>ï¼ˆæ­¤æ—¶è¿˜æ²¡æ”¶åˆ°æ¥è‡ªCPU 0 çš„<code>Read Invalidate</code>æ¶ˆæ¯ï¼Œå› æ­¤CPU 1 æœ‰ç†ç”±è®¤ä¸ºè‡ªå·±çš„æ•°æ®å°±æ˜¯åˆæ³•çš„ï¼‰ï¼Œå› æ­¤æ–­è¨€ç»“æœä¸ºFalseï¼›</li><li>CPU 1 ç»ˆäºæ”¶åˆ°æ¥è‡ªCPU 0 çš„<code>Read Invalidate</code>æ¶ˆæ¯äº†ï¼Œè™½ç„¶å·²ç»æ™šäº†ï¼ˆå½“ç„¶CPUå‹æ ¹ä¸çŸ¥é“è‡ªå·±çš„è¿™ä¸ªæ¶ˆæ¯æ¥æ”¶çš„æ—¶æœºå¹¶ä¸åˆé€‚ï¼‰ï¼Œä½†æ˜¯è¿˜å¾—æŒ‰ç…§çº¦å®šæŠŠè‡ªå·±çš„<code>a</code>è®¾ç½®ä¸º<code>Invalid</code>çŠ¶æ€ï¼Œå¹¶ä¸”ç»™CPU 0 å‘é€<code>Invalidate Acknowledge</code>ä»¥åŠ<code>Read Response</code>åé¦ˆï¼›</li><li>CPU 0 æ”¶åˆ°CPU 1 çš„åé¦ˆï¼Œåˆ©ç”¨<code>Store Buffer</code>ä¸­çš„å€¼æ›´æ–°<code>a</code>ã€‚</li></ol><p>è‡³æ­¤ï¼Œæµç¨‹å…¨éƒ¨ç»“æŸï¼Œå†é€ç»™å¤§å®¶ä¸€ä¸ªGIFã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024531.gif" alt="img" loading="lazy"></p><p>æˆ‘ä»¬åˆ†æä¸€ä¸‹ç»“æœä¸ç¬¦åˆæˆ‘ä»¬é¢„æœŸçš„åŸå› ã€‚</p><p><code>Store Buffer</code>çš„åŠ å…¥å¯¼è‡´<code>Read Invalidate</code>çš„å‘é€æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼Œå¼‚æ­¥å¯èƒ½å¯¼è‡´çš„ç»“æœå°±æ˜¯CPU 1 æ¥æ”¶åˆ°CPU 0 çš„<code>Read Invalidate</code>æ¶ˆæ¯å¤ªæ™šäº†ï¼Œå¯¼è‡´åœ¨Cacheä¸­çš„å®é™…æ“ä½œé¡ºåºæ˜¯<code>b = 1</code>ï¼Œæœ€åæ‰æ˜¯<code>a = 1</code>ï¼Œå°±å¥½åƒ<strong>å†™æ“ä½œè¢«é‡æ’åº</strong>äº†ä¸€æ ·ï¼Œè¿™å°±æ˜¯<strong>ä¹±åºæ‰§è¡Œ</strong>ã€‚</p><div class="custom-container tip"><p class="custom-container-title">ä¹±åºæ‰§è¡Œ != CPUä¹±åºæ‰§è¡Œ</p><p>è¿™é‡Œçš„ <strong>ä¹±åºæ‰§è¡Œ</strong> å¹¶éæ˜¯CPU ä¸ºäº†æå‡è¿è¡Œæ•ˆç‡å’Œæé«˜ç¼“å­˜å‘½ä¸­ç‡ï¼Œè€Œå¯¼è‡´çš„<strong>CPUä¹±åºæ‰§è¡Œ</strong>ï¼Œåªä¸è¿‡æ˜¯<code>Store Buffer</code>çš„å‰¯ä½œç”¨ç½¢äº†ã€‚</p><p>ä½†æ˜¯ä¸èƒ½å¦è®¤çš„æ˜¯ï¼Œ<strong>CPUä¹±åºæ‰§è¡Œ</strong>ä¹Ÿå¯èƒ½å¯¼è‡´è¿™æ ·çš„æƒ…å†µå‘ç”Ÿã€‚</p></div><p>å¦‚æœæ²¡æœ‰çœ‹æ‡‚ä¸Šé¢ä¸€æ®µå°±å†çœ‹ä¸€ä¸‹å›¾ç‰‡ä¸­çš„CPU 0 Cacheçš„æ—¶é—´çº¿æ¼”åŒ–ã€‚</p><p>å¾ˆå¤šäººçœ‹åˆ°ã€Œä¹±åºæ‰§è¡Œã€å”¯æé¿ä¹‹ä¸åŠï¼Œå®ƒå½“åˆå¯æ˜¯ä¸ºäº†æé«˜CPUçš„å·¥ä½œæ•ˆç‡è€Œè¯ç”Ÿçš„ï¼Œè€Œä¸”åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹å¹¶ä¸ä¼šå¯¼è‡´ä»€ä¹ˆé”™è¯¯ï¼Œåªæ˜¯åœ¨å¤šå¤„ç†å™¨ï¼ˆsmpï¼‰å¹¶å‘æ‰§è¡Œçš„æ—¶å€™å¯èƒ½ä¼šå‡ºç°é—®é¢˜ï¼Œäºæ˜¯ä¾¿æœ‰äº†ä¸‹æ–‡ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœåœ¨ç¬¬5æ­¥CPU 0 ä¿®æ”¹<code>b</code>ä¹‹å‰ï¼Œæˆ‘ä»¬å¼ºåˆ¶è®©CPU 0å…ˆå®Œæˆå¯¹<code>a</code>çš„ä¿®æ”¹å°±å¯ä»¥äº†ã€‚</p><p>ä¸ºäº†è§£å†³è¿™æ ·çš„é—®é¢˜ï¼ŒCPUæä¾›äº†ä¸€äº›æ“ä½œæŒ‡ä»¤ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬é¿å…è¿™æ ·çš„é—®é¢˜ï¼Œå°±æ˜¯å¤§åé¼é¼çš„<strong>å†…å­˜å±éšœ</strong>ï¼ˆMemory Barrier,mbï¼‰ã€‚</p><h3 id="_6-5-å†…å­˜å±éšœ" tabindex="-1"><a class="header-anchor" href="#_6-5-å†…å­˜å±éšœ" aria-hidden="true">#</a> 6.5. å†…å­˜å±éšœ</h3><p>æˆ‘ä»¬ç¨å¾®ä¿®æ”¹ä¸€ä¸‹<code>foo</code>æ–¹æ³•ï¼Œåœ¨<code>b = 1</code>ä¹‹å‰æ·»åŠ ä¸€æ¡å†…å­˜å±éšœæŒ‡ä»¤<code>smp_mb()</code>ã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024548.png" alt="å†…å­˜å±éšœ" loading="lazy"></p><div class="custom-container tip"><p class="custom-container-title">å¤šè¯´ä¸€ç‚¹</p><p><code>smp</code>çš„å…¨ç§°æ˜¯Symmetrical Multi-Processingï¼ˆå¯¹ç§°å¤šå¤„ç†ï¼‰æŠ€æœ¯ï¼Œæ˜¯æŒ‡åœ¨ä¸€ä¸ªè®¡ç®—æœºä¸Šæ±‡é›†äº†ä¸€ç»„å¤„ç†å™¨(å¤šCPU)ï¼Œå„CPUä¹‹é—´å…±äº«å†…å­˜å­ç³»ç»Ÿä»¥åŠæ€»çº¿ç»“æ„ã€‚</p><p>ç”±äºåœ¨ä¸åŒçš„ä½“ç³»ç»“æ„ä¸Šï¼ŒæŒ‡ä»¤å„ä¸ç›¸åŒï¼Œæˆ‘ä»¬ä½¿ç”¨<code>smp_mb</code>å¯¹å†…å­˜å±éšœè¿›è¡ŒæŠ½è±¡.</p></div><p>ä¸ºä»€ä¹ˆè¦ç‰¹æ„åŠ ä¸Š<code>smp</code>å‘¢ï¼Ÿå› ä¸ºå³ä¾¿ç°ä»£å¤„ç†å™¨ä¼šä¹±åºæ‰§è¡Œï¼Œä½†åœ¨å•ä¸ªCPUä¸Šï¼ŒæŒ‡ä»¤èƒ½é€šè¿‡æŒ‡ä»¤é˜Ÿåˆ—é¡ºåºè·å–æŒ‡ä»¤å¹¶æ‰§è¡Œï¼Œç»“æœåˆ©ç”¨é˜Ÿåˆ—é¡ºåºè¿”å›å¯„å­˜å™¨ï¼Œè¿™ä½¿å¾—ç¨‹åºæ‰§è¡Œæ—¶æ‰€æœ‰çš„å†…å­˜è®¿é—®æ“ä½œçœ‹èµ·æ¥åƒæ˜¯æŒ‰ç¨‹åºä»£ç ç¼–å†™çš„é¡ºåºæ‰§è¡Œçš„ï¼Œå› æ­¤æ²¡å¿…è¦ä½¿ç”¨å†…å­˜å±éšœï¼ˆå‰ææ˜¯ä¸è€ƒè™‘ç¼–è¯‘å™¨çš„ä¼˜åŒ–çš„æƒ…å†µï¼‰ã€‚</p><p>å†…å­˜å±éšœå¬èµ·æ¥å¾ˆé«˜å¤§ä¸Šï¼Œä½†æ˜¯å¯¹äºè½¯ä»¶å¼€å‘è€…è€Œè¨€å…¶å®éå¸¸ç®€å•ï¼Œæ€»ç»“ä¸€å¥è¯å°±æ˜¯ï¼š</p><p><strong>åœ¨å†…å­˜å±éšœè¯­å¥ä¹‹åçš„æ‰€æœ‰é’ˆå¯¹Cacheçš„å†™æ“ä½œå¼€å§‹ä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠStore Bufferä¸­çš„æ•°æ®å…¨éƒ¨åˆ·æ–°åˆ°Cacheä¸­ã€‚</strong></p><p>å¦‚æœä½ çœ‹æ˜ç™½äº†æˆ‘ä¸Šé¢è¯´çš„<code>Store Buffer</code>ï¼Œè¿™å¥è¯æ˜¯ä¸æ˜¯è´¼å¥½æ‡‚å‘¢ï¼Ÿæ¢ä¸ªè§’åº¦å†ç¿»è¯‘ä¸€ä¸‹ï¼Œå°±æ˜¯ä¸€å®šè¦ä¿è¯<strong>å­˜åˆ°Store Bufferä¸­çš„æ•°æ®æœ‰åºåœ°åˆ·æ–°åˆ°Cacheä¸­</strong>ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…å‘ç”ŸæŒ‡ä»¤é‡æ’åºäº†ã€‚</p><p>å¦‚ä½•ä¿è¯æœ‰åºå‘¢ï¼Ÿ</p><p>æœ€ç®€å•çš„æ–¹å¼å°±æ˜¯è®©CPUå‚»ç­‰ï¼Œ<code>CPU 0</code> åœ¨æ‰§è¡Œç¬¬5æ­¥ä¹‹å‰å¿…é¡»ç­‰ç€<code>CPU 1</code>ç»™å‡ºåé¦ˆï¼Œç›´åˆ°æ¸…ç©ºè‡ªå·±çš„<code>Store Buffer</code>ï¼Œç„¶åæ‰èƒ½ç»§ç»­å‘ä¸‹æ‰§è¡Œã€‚</p><p>å•¥ï¼Ÿåˆè®©CPUé—²ç€ï¼Ÿä¸€åˆ‡è®©CPUé—²ç½®çš„æ–¹æ³•éƒ½æ˜¯é¦Šä¸»æ„ï¼</p><p>è¿˜æœ‰ä¸€ä¸ªåŠæ³•å°±æ˜¯è®©æ•°æ®åœ¨<code>Store Buffer</code>ä¸­æ’é˜Ÿï¼Œè°å…ˆè¿›å…¥å°±å¿…é¡»å…ˆåˆ·æ–°è°ï¼Œåè¾¹çš„å¿…é¡»ç­‰ç€ï¼</p><p><strong>è¿™æ ·ä¸€æ¥ï¼Œæœ¬æ¥å¯ä»¥ç›´æ¥å†™å…¥Cacheçš„æ“ä½œï¼ˆæ¯”å¦‚å¾…æ“ä½œçš„æ•°æ®å·²ç»å­˜åœ¨äºè‡ªå·±çš„Cacheä¸­äº†ï¼‰ä¹Ÿå¿…é¡»å…ˆå­˜åˆ°Store Bufferï¼Œç„¶åä¾åºè¿›è¡Œåˆ·æ–°</strong>ã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024555.gif" alt="img" loading="lazy"></p><p>åº”ç”¨å†…å­˜å±éšœä¹‹åçš„æ“ä½œæ­¥éª¤å°±ä¸ç»™å¤§å®¶å†å†™ä¸€éäº†ï¼Œç›¸ä¿¡å¤§å®¶èƒ½å¤Ÿæƒ³æ¸…æ¥šã€‚</p><p>æ€»ä¹‹ï¼Œå¼•å‘çš„ç¬¬2ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬é€šè¿‡ä½¿ç”¨å†…å­˜å±éšœè§£å†³äº†ã€‚</p><h3 id="_6-6-store-bufferså¼•èµ·çš„é—®é¢˜3" tabindex="-1"><a class="header-anchor" href="#_6-6-store-bufferså¼•èµ·çš„é—®é¢˜3" aria-hidden="true">#</a> 6.6. Store Bufferså¼•èµ·çš„é—®é¢˜3</h3><p><code>Store Buffer</code>çš„å®¹é‡é€šå¸¸å¾ˆå°ï¼Œå¦‚æœCPUæ­¤æ—¶éœ€è¦å¯¹å¤šä¸ªæ•°æ®æ‰§è¡Œwriteæ“ä½œï¼Œç¢°å·§è¿™äº›æ•°æ®éƒ½ä¸åœ¨è¯¥CPUçš„Cacheä¸­ï¼Œé‚£ä¹ˆè¯¥CPUåªèƒ½å‘é€å¯¹åº”çš„<code>Read Invalidate</code>æŒ‡ä»¤äº†ï¼ŒåŒæ—¶æ–°æ•°æ®å†™å…¥<code>Store Buffer</code>ï¼Œéå¸¸å®¹æ˜“å¯¼è‡´<code>Store Buffer</code>ç©ºé—´è¢«å æ»¡ã€‚</p><p>ä¸€æ—¦<code>Store Buffer</code>è¢«å æ»¡ï¼ŒCPUå°±åªèƒ½<strong>å¹²ç­‰ç€</strong>ç›®æ ‡CPUå®Œæˆ<code>Read Invalidate</code>æ“ä½œï¼Œå¹¶ä¸”è¿”ç»™è‡ªå·±<code>Invalidate Acknowledge</code>ï¼Œå½“å‰CPUæ‰èƒ½é€æ­¥å°†<code>Store Buffer</code>ä¸­çš„å€¼åˆ·æ–°åˆ°Cacheï¼Œè…¾å‡ºç©ºé—´ï¼Œç„¶åç»§ç»­æ‰§è¡Œã€‚</p><p>CPUåˆåˆåˆé—²ä¸‹æ¥äº†ï¼æ‰€ä»¥æˆ‘ä»¬è‚¯å®šåˆå¾—æ‰¾ä¸ªåŠæ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>å‡ºç°è¿™ä¸ªé—®é¢˜çš„ä¸»è¦åŸå› åœ¨äº<code>Invalidate Acknowledge</code>çš„åé¦ˆé€Ÿåº¦å¤ªæ…¢äº†ï¼</p><p>å› ä¸ºCPUå¤ªè€å®äº†ï¼Œå®ƒåªæœ‰åœ¨ç¡®è®¤è‡ªå·±çš„ç¼“å­˜è¡Œè¢«è®¾ç½®ä¸º<code>Invalid</code>çŠ¶æ€ä¹‹åæ‰ä¼šå‘é€<code>Invalidate Acknowledge</code>ã€‚å¦‚æœCacheçš„å…¶ä»–æ“ä½œå¤ªé¢‘ç¹ï¼Œâ€œè®¾ç½®ç¼“å­˜è¡Œä¸ºInvalidçŠ¶æ€â€è¿™ä¸ªåŠ¨ä½œæœ¬èº«éƒ½ä¼šè¢«å»¶è¿Ÿæ‰§è¡Œï¼Œæ›´ä½•å†µ<code>Invalidate Acknowledge</code>çš„åé¦ˆåŠ¨ä½œå‘¢ï¼Œå¾—ç­‰åˆ°çŒ´å¹´é©¬æœˆå•Šï¼</p><blockquote><p>ä¸Šé¢çš„GIFå›¾ä¸­ä¸ºäº†è¡¨ç°å‡ºã€Œåé¦ˆæ…¢ã€è¿™ç§æƒ…å†µï¼Œæˆ‘ç‰¹æ„æŠŠ<code>Invalidate</code>æ¶ˆæ¯çš„å‘é€é€Ÿåº¦è®¾ç½®åœ°å¾ˆæ…¢ï¼Œå…¶å®æ¶ˆæ¯åœ°å‘é€é€Ÿåº¦éå¸¸å¿«ï¼Œåªæ˜¯CPUå¤„ç†<code>Invalidate</code>æ¶ˆæ¯çš„é€Ÿåº¦å¤ªæ…¢äº†è€Œå·²ï¼Œæœ›æ‚‰çŸ¥ã€‚</p></blockquote><p>å¦‚æœä¸æƒ³ç­‰ï¼Œæƒ³ç›´æ¥è·å–æ“ä½œç»“æœï¼Œä½ æƒ³åˆ°äº†ä»€ä¹ˆï¼Ÿ</p><p>æ²¡é”™ï¼Œæ˜¯å¼‚æ­¥ï¼</p><p>å®ç°æ–¹å¼å°±æ˜¯å†åŠ ä¸€å±‚æ¶ˆæ¯é˜Ÿåˆ—â€”â€”<code>Invalidate Queues</code>ã€‚</p><h3 id="_6-7-å¼•å…¥invalidate-queues" tabindex="-1"><a class="header-anchor" href="#_6-7-å¼•å…¥invalidate-queues" aria-hidden="true">#</a> 6.7. å¼•å…¥Invalidate Queues</h3><p>å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬çš„ç¡¬ä»¶æ¶æ„åˆå‡çº§äº†ã€‚åœ¨æ¯ä¸ªCPUçš„Cacheä¹‹ä¸Šï¼Œåˆè®¾ç½®äº†ä¸€ä¸ª<code>Invalidate Queue</code>ã€‚</p><p>è¿™æ ·ä¸€æ¥ï¼Œæ”¶åˆ°<code>Invalidate</code>æ¶ˆæ¯çš„CPUæ ¸å¿ƒä¼šæŠŠ<code>Invalidate</code>æ¶ˆæ¯ç›´æ¥å­˜å‚¨åˆ°<code>Invalidate Queue</code>ä¸­ï¼Œç„¶åç«‹å³è¿”å›<code>Invalidate Acknowledge</code>ï¼Œä¸éœ€è¦å†ç­‰ç€ç¼“å­˜è¡Œè¢«å®é™…è®¾ç½®æˆ<code>Invalid</code>çŠ¶æ€å†å‘é€ï¼Œæå¤§åœ°æé«˜äº†åé¦ˆé€Ÿåº¦ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œä¸‡ä¸€<code>Invalidate Queues</code>ä¸­çš„<code>Invalidate</code>æ¶ˆæ¯æœ€ç»ˆæ‰§è¡Œå¤±è´¥ï¼Œä½†æ˜¯<code>Acknowledge</code>æ¶ˆæ¯å·²ç»è¿”å›äº†ï¼Œè¿™è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>å¥½é—®é¢˜ï¼ç­”æ¡ˆæ˜¯ï¼Œæˆ‘ä¸çŸ¥é“ã€‚æˆ‘ä»¬å°±å½“ä½œç¡¬ä»¶å·¥ç¨‹å¸ˆç»å¯¹ä¸ä¼šç•™ä¸‹è¿™ä¸ªbugå°±æ˜¯äº†ã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024604.png" alt="Invalidate Queue" loading="lazy"></p><p><code>Invalidate Queue</code>å¡«äº†<code>Store Buffer</code>å®¹é‡å¤ªå°çš„å‘ï¼Œæ¥ä¸‹æ¥çœ‹çœ‹å®ƒè‡ªå·±åˆæŒ–äº†ä»€ä¹ˆå‘å§ã€‚</p><h4 id="_6-7-1-invalidate-queueå¼•å‘çš„é—®é¢˜" tabindex="-1"><a class="header-anchor" href="#_6-7-1-invalidate-queueå¼•å‘çš„é—®é¢˜" aria-hidden="true">#</a> 6.7.1. Invalidate Queueå¼•å‘çš„é—®é¢˜</h4><p>è¿™ä¸ªå‘æ¯”è¾ƒä¸¥é‡ï¼Œå¾ˆæœ‰å¯èƒ½ç›´æ¥å¹²ç¿»ç¼“å­˜å±éšœï¼Œå†æ¬¡å¼•å‘ä¹±åºæ‰§è¡Œçš„é—®é¢˜ã€‚</p><p>è€æ ·å­ï¼Œè¿˜æ˜¯å…ˆå‡†å¤‡ä¸€ä¸‹ç¿»è½¦çš„ç¯å¢ƒã€‚å¦‚ä¸‹å›¾ï¼Œæˆ‘ä»¬å‡è®¾å˜é‡<code>a</code>è¢«<code>CPU 0</code> å’Œ<code>CPU 1</code> å…±äº«ï¼Œä¸º<code>Shared</code>çŠ¶æ€ï¼›å˜é‡<code>b</code>è¢«<code>CPU 0</code> ç‹¬å ï¼Œä¸º<code>Exclusive</code>çŠ¶æ€ï¼›<code>CPU 0</code> å’Œ<code>CPU 1</code> åˆ†åˆ«æ‰§è¡Œ<code>foo</code>å’Œ<code>bar</code>æ–¹æ³•ã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024608.png" alt="img" loading="lazy"></p><p>æˆ‘ä»¬æŒ‰ç…§ä¸‹å›¾ä¸­çš„æ‰§è¡Œé¡ºåºæ“ä½œä¸€éã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024615.png" alt="img" loading="lazy"></p><ol><li>CPU 0 æ‰§è¡Œ<code>a = 1</code>ï¼Œå› ä¸ºCPU 0 çš„Cacheä¸­å·²ç»æœ‰<code>a</code>äº†ï¼ŒçŠ¶æ€ä¸º<code>Shared</code>ï¼Œå› æ­¤ä¸èƒ½ç›´æ¥ä¿®æ”¹ï¼Œéœ€è¦å‘é€<code>Invalidate</code>ï¼ˆä¸æ˜¯<code>Read Invalidate</code>ï¼Œå› ä¸ºè‡ªå·±æœ‰<code>a</code>ï¼‰æ¶ˆæ¯ä½¿å…¶ä»–ç¼“å­˜è¡Œå¤±æ•ˆï¼›</li><li>CPU 0 æŠŠè¯•å›¾ä¿®æ”¹çš„<code>a</code>çš„æœ€æ–°å€¼<code>1</code>æ”¾å…¥<code>Store Buffer</code>ï¼›</li><li>CPU 0 å‘é€<code>Invalidate</code>æ¶ˆæ¯ï¼›</li><li>CPU 1 æ‰§è¡Œ<code>while(b == 0) continue;</code>å‘ç°<code>b</code>ä¸åœ¨è‡ªå·±çš„Cacheä¸­ï¼Œäºæ˜¯å‘é€<code>Read</code>æ¶ˆæ¯æ¥è·å–<code>b</code>ï¼›</li><li>CPU 1 æ”¶åˆ°æ¥è‡ªCPU 0 çš„<code>Invalidate</code>æ¶ˆæ¯ï¼ŒæŠŠè¯¥æ¶ˆæ¯æ”¾å…¥<code>Invalidate Queue</code>ä¸­ï¼ˆå¹¶æ²¡æœ‰ç«‹å³è®©<code>a</code>å¤±æ•ˆï¼‰ï¼Œç­‰å€™å¤„ç†ï¼Œç„¶å<strong>ç«‹åˆ»</strong>è¿”å›<code>Anknowledge</code>ï¼›</li><li>CPU 0 æ”¶åˆ°<code>Acknowledge</code>æ¶ˆæ¯ï¼Œè®¤ä¸ºCPU 1 å·²ç»æŠŠ<code>a</code>å€¼è®¾ç½®ä¸º<code>Invalid</code>äº†ï¼Œäºæ˜¯æ”¾å¿ƒåœ°æŠŠ<code>Store Buffer</code>ä¸­çš„æ•°æ®åˆ·æ–°åˆ°è‡ªå·±çš„Cacheä¸­ï¼Œæ­¤æ—¶CPU 0 Cacheä¸­çš„<code>a</code>ä¸º<code>1</code>ï¼ŒçŠ¶æ€ä¸º<code>Modified</code>ï¼›ç„¶åå°±å¯ä»¥ç›´æ¥è¶Šè¿‡<code>smp_mb()</code>å†…å­˜å±éšœï¼Œå› ä¸ºç°åœ¨<code>Store Buffer</code>ä¸­çš„æ•°æ®å·²ç»ç©ºäº†ï¼Œæ»¡è¶³å†…å­˜å±éšœçš„çº¦æŸæ¡ä»¶ã€‚</li><li>CPU 0 æ‰§è¡Œ<code>b = 1</code>ï¼Œå› ä¸ºå…¶ç‹¬å äº†<code>b</code>ï¼Œæ‰€ä»¥å¯ä»¥ç›´æ¥åœ¨Cacheä¸­ä¿®æ”¹<code>b</code>çš„å€¼ï¼Œæ­¤æ—¶<code>b</code>ç¼“å­˜è¡Œçš„çŠ¶æ€ä¸º<code>Modified</code>ï¼›</li><li>CPU 0 æ”¶åˆ°æ¥è‡ªCPU 1 çš„<code>Read</code>æ¶ˆæ¯ï¼Œå°†ä¿®æ”¹ä¹‹åçš„<code>b</code>ç¼“å­˜è¡Œè¿”å›ï¼Œå¹¶ä¿®æ”¹è‡ªå·±Cacheä¸­çš„<code>b</code>ç¼“å­˜è¡Œçš„çŠ¶æ€ä¸º<code>Shared</code>ï¼›</li><li>CPU 1 æ”¶åˆ°åŒ…å«<code>b</code>çš„ç¼“å­˜è¡Œæ•°æ®ï¼Œæ”¾åœ¨è‡ªå·±çš„Cacheä¸­ï¼Œæ­¤æ—¶CPU 1 çš„CacheåŒæ—¶æ‹¥æœ‰äº†<code>a</code>å’Œ<code>b</code>ï¼›</li><li>CPU 1 ç»“æŸæ‰§è¡Œ<code>while(b == 0) continue;</code>å› ä¸ºæ­¤æ—¶CPU 1 è¯»åˆ°çš„<code>b</code>å·²ç»æ˜¯<code>1</code>äº†ï¼›</li><li>CPU 1 å¼€å§‹æ‰§è¡Œ<code>assert(a == 1)</code>ï¼ŒCPU 1 ä»è‡ªå·±çš„Cacheè¯»åˆ°<code>a</code>ä¸º<code>0</code>ï¼Œæ–­è¨€ä¸ºFalseã€‚</li><li>CPU 1 å¼€å§‹å¤„ç†<code>Invalidate Queue</code>é˜Ÿåˆ—ï¼Œä»¤Cacheä¸­çš„<code>a</code>å¤±æ•ˆï¼Œä½†æ˜¯ä¸ºæ—¶å·²æ™šï¼</li></ol><p>è‡³æ­¤æµç¨‹å…¨éƒ¨ç»“æŸï¼Œå†ä¸Šä¸ªGIFã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024620.gif" alt="img" loading="lazy"></p><p>é—®é¢˜å¾ˆæ˜æ˜¾å‡ºåœ¨ç¬¬11æ­¥ï¼Œè¿™å°±æ˜¯è‡­åæ˜­è‘—è‘—åçš„<strong>å¯è§æ€§é—®é¢˜</strong>ã€‚<code>CPU 0</code> ä¿®æ”¹äº†<code>a</code>çš„å€¼ï¼Œ<code>CPU 1</code> å´ä¸çŸ¥é“æˆ–è€…è¯´çŸ¥é“çš„å¤ªæ™šï¼å¦‚æœåœ¨ç¬¬11æ­¥è¯»å–<code>a</code>çš„å€¼ä¹‹å‰å°±èµ¶ç´§åˆ·æ–°<code>Invalidate Queue</code>ä¸­çš„æ¶ˆæ¯ï¼Œè®©<code>a</code>å¤±æ•ˆå°±å¥½äº†ï¼Œè¿™æ ·<code>CPU 1</code> å°±ä¸å¾—ä¸é‡æ–°<code>Read</code>ï¼Œå¾—åˆ°çš„ç»“æœè‡ªç„¶å°±æ˜¯<code>1</code>äº†ã€‚</p><p>åŸå› ææ˜ç™½äº†ï¼Œæ€ä¹ˆè§£å†³å‘¢ï¼Ÿå†…å­˜å±éšœå†ä¸€æ¬¡é—ªäº®ç™»åœºï¼</p><h4 id="_6-7-2-å†…å­˜å±éšœçš„å¦ä¸€ä¸ªåŠŸèƒ½" tabindex="-1"><a class="header-anchor" href="#_6-7-2-å†…å­˜å±éšœçš„å¦ä¸€ä¸ªåŠŸèƒ½" aria-hidden="true">#</a> 6.7.2. å†…å­˜å±éšœçš„å¦ä¸€ä¸ªåŠŸèƒ½</h4><p>ä¸Šæ–‡å·²ç»è§£é‡Šäº†å†…å­˜å±éšœçš„åŠŸèƒ½ï¼Œå†æŠ„ä¸€éåŠ æ·±å°è±¡ï¼š</p><p><strong>1.åœ¨å†…å­˜å±éšœè¯­å¥ä¹‹åçš„æ‰€æœ‰é’ˆå¯¹Cacheçš„</strong><code>å†™æ“ä½œ</code><strong>å¼€å§‹ä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠ<code>Store Buffer</code>ä¸­çš„æ•°æ®å…¨éƒ¨åˆ·æ–°åˆ°Cacheä¸­ã€‚</strong></p><p>å…¶å®å†…å­˜å±éšœè¿˜æœ‰å¦ä¸€ä¸ªåŠŸèƒ½ï¼š</p><p><strong>2.åœ¨å†…å­˜å±éšœè¯­å¥ä¹‹åçš„æ‰€æœ‰é’ˆå¯¹Cacheçš„</strong><code>è¯»æ“ä½œ</code><strong>å¼€å§‹ä¹‹å‰ï¼Œå¿…é¡»å…ˆæŠŠ<code>Invalidate Queue</code>ä¸­çš„æ•°æ®å…¨éƒ¨ä½œç”¨åˆ°Cacheä¸­ã€‚</strong></p><p>ä½¿ç”¨ç¼“å­˜å±éšœä¹‹åçš„ä»£ç å°±å˜æˆäº†è¿™ä¸ªæ ·å­ï¼š</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024652.png" alt="img" loading="lazy"></p><p><code>bar</code>æ–¹æ³•åœ¨<code>assert</code>ä¹‹å‰æ·»åŠ äº†å†…å­˜å±éšœï¼Œæ„å‘³ç€åœ¨è·å–<code>a</code>çš„å€¼ä¹‹å‰ï¼Œæ‰€æœ‰åœ¨<code>Invalidate Queue</code>ä¸­çš„<code>Invalidate</code>æ¶ˆæ¯å¿…é¡»ä½œç”¨åˆ°Cacheä¸­ã€‚</p><p>è‡³æ­¤ï¼Œæˆ‘ä»¬å†æ¬¡ç”¨å†…å­˜å±éšœè§£å†³äº†å¯è§æ€§é—®é¢˜ã€‚</p><p>é—®é¢˜è¿˜æ²¡æœ‰ç»“æŸ......</p><h2 id="_7-è¯»å†…å­˜å±éšœ-å†™å†…å­˜å±éšœ" tabindex="-1"><a class="header-anchor" href="#_7-è¯»å†…å­˜å±éšœ-å†™å†…å­˜å±éšœ" aria-hidden="true">#</a> 7. è¯»å†…å­˜å±éšœ &amp; å†™å†…å­˜å±éšœ</h2><p>å†…å­˜å±éšœæœ‰ä¸¤ä¸ªåŠŸèƒ½ï¼Œåœ¨<code>foo</code>æ–¹æ³•ä¸­å®é™…å‘æŒ¥ä½œç”¨çš„æ˜¯åŠŸèƒ½1ï¼ŒåŠŸèƒ½2å¹¶æ²¡æœ‰æ´¾ä¸Šç”¨åœºï¼›åŒç†ï¼Œåœ¨<code>bar</code>æ–¹æ³•ä¸­å®é™…å‘æŒ¥ä½œç”¨çš„æ˜¯åŠŸèƒ½2ï¼ŒåŠŸèƒ½1å¹¶æ²¡æœ‰æ´¾ä¸Šç”¨åœºã€‚äºæ˜¯å¾ˆå¤šä¸åŒå‹å·çš„CPUæ¶æ„ï¼ˆä¸æ˜¯æ‰€æœ‰ï¼‰å°†å†…å­˜å±éšœåŠŸèƒ½åˆ†ä¸ºäº†<strong>è¯»å†…å­˜å±éšœ</strong>å’Œ<strong>å†™å†…å­˜å±éšœ</strong>ï¼Œå…·ä½“å¦‚ä¸‹ã€‚</p><ul><li><code>smp_mb</code>ï¼ˆå…¨å†…å­˜å±éšœï¼ŒåŒ…å«è¯»å’Œå†™å…¨éƒ¨åŠŸèƒ½ï¼‰</li><li><code>smp_rmb</code>ï¼ˆread memory barrierï¼Œä»…åŒ…å«åŠŸèƒ½2ï¼‰</li><li><code>smp_wmb</code>ï¼ˆwrite memory barrierï¼Œä»…åŒ…å«åŠŸèƒ½1ï¼‰</li></ul><p>ä¸Šæ–‡å·²ç»è§£é‡Šåœ°æŒºæ¸…æ¥šäº†ï¼Œå› æ­¤å°±ä¸å†é‡å¤ä»‹ç»<code>smp_rmb</code>å’Œ<code>smp_wmb</code>çš„ä½œç”¨äº†ã€‚ç›´æ¥çœ‹ä¿®æ”¹ä¹‹åçš„ä»£ç å§ã€‚</p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024659.png" alt="img" loading="lazy"></p><h2 id="_8-æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#_8-æ€»ç»“" aria-hidden="true">#</a> 8. æ€»ç»“</h2><p>è®¡ç®—æœºçš„æ¼”è¿›å°±æ˜¯ä¸€éƒ¨åå¤æŒ–å‘ã€å¡«å‘çš„å‘å±•å²ã€‚</p><p>ä¸ºäº†è§£å†³å†…å­˜å’ŒCPUä¹‹é—´é€Ÿåº¦å·®å¼‚è¿‡å¤§çš„é—®é¢˜ï¼Œå¼•å…¥äº†é«˜é€Ÿç¼“å­˜Cacheï¼Œç»“æœå¯¼è‡´äº†ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼›</p><p>ä¸ºäº†è¾¾åˆ°ç¼“å­˜ä¸€è‡´çš„æ•ˆæœï¼ŒCPUä¹‹é—´éœ€è¦æ²Ÿé€šå•Šï¼Œäºæ˜¯åˆè®¾è®¡äº†å„ç§æ¶ˆæ¯ä¼ é€’ï¼Œç»“æœæ¶ˆæ¯ä¼ é€’å¯¼è‡´äº†CPUçš„å¶å°”é—²ç½®ï¼›</p><p>ä¸ºäº†ä¸è®©CPUåœä¸‹æ¥ï¼Œæå‡CPUå†™æ€§èƒ½ï¼Œç¡¬ä»¶å·¥ç¨‹å¸ˆåŠ å…¥äº†å†™ç¼“å†²â€”â€”<code>Store Buffer</code>ï¼Œè¿™ä¸€ä¸‹å­å¸¦æ¥äº†3ä¸ªé—®é¢˜ï¼</p><p>ç¬¬ä¸€ä¸ªé—®é¢˜æ¯”è¾ƒç®€å•ï¼Œé€šè¿‡å¼•å…¥<code>Store Forwarding</code>è§£å†³äº†ï¼›</p><p>ç¬¬äºŒä¸ªé—®é¢˜æ˜¯æ“ä½œé‡æ’åºé—®é¢˜ï¼Œæˆ‘ä»¬åˆå¼•å…¥äº†å†…å­˜å±éšœçš„ç¬¬ä¸€ä¸ªå¤§æ‹›ï¼›</p><p>ç¬¬ä¸‰ä¸ªé—®é¢˜æ˜¯ç”±äº<code>Store Buffer</code>ç©ºé—´é™åˆ¶å¯¼è‡´CPUåˆé—²ä¸‹æ¥äº†ï¼Œäºæ˜¯åˆè®¾è®¡äº†<code>Invalidate Queues</code>ï¼Œç„¶ååˆå¯¼è‡´äº†ä¹±åºæ‰§è¡Œå’Œå¯è§æ€§é—®é¢˜ï¼›</p><p>é€šè¿‡ä½¿ç”¨å†…å­˜å±éšœçš„å…¨éƒ¨å¤§æ‹›ç»ˆäºè§£å†³äº†ä¹±åºæ‰§è¡Œå’Œå¯è§æ€§é—®é¢˜ï¼Œåˆå¼•å‡ºäº†å¤§æ‹›ä¼¤å®³æ€§è¿‡å¼ºçš„é—®é¢˜ï¼Œäºæ˜¯åˆæ‹†åˆ†æˆäº†æ›´ç»†ç²’åº¦çš„<code>è¯»å±éšœ</code>å’Œ<code>å†™å±éšœ</code>ã€‚ã€‚ã€‚ã€‚ã€‚ã€‚</p><h2 id="_9-åè®°" tabindex="-1"><a class="header-anchor" href="#_9-åè®°" aria-hidden="true">#</a> 9. åè®°</h2><p>é—®é¢˜å…¶å®è¿˜æœ‰å¾ˆå¤šï¼Œæ¯”å¦‚å„ç§ä¸åŒCPUç»“æ„æ˜¯æ€ä¹ˆå®ç°å†…å­˜å±éšœçš„ï¼Ÿå¯æƒ³è€ŒçŸ¥ï¼Œæ¯ä¸ªäººéƒ½æœ‰æ¯ä¸ªäººçš„æƒ³æ³•ï¼Œä¸åŒCPUçš„å®ç°æŒ‡å®šä¹Ÿä¸ä¸€æ ·ï¼Œç”šè‡³å¯èƒ½æ‹†åˆ†åœ°æ›´ç»†æˆ–è€…æ›´ç²—ã€‚ä¸è¿‡è¿™äº›ä¸å¤§éƒ¨åˆ†è½¯ä»¶å¼€å‘è€…ï¼ˆåŒ…æ‹¬æˆ‘ï¼‰éƒ½æ²¡æœ‰ä»€ä¹ˆå…³ç³»äº†ï¼Œæ›´å¤šé—®é¢˜è¿˜æ˜¯ç•™ç»™èŠ¯ç‰‡å¼€å‘è€…ä»¥åŠæ“ä½œç³»ç»Ÿå¼€å‘è€…å§ã€‚</p><p>ä¸è¦çº ç»“äºå…·ä½“çš„å®ç°ç»†èŠ‚ï¼ŒæŠŠæ–‡ç« ä¸­çš„å¤§éƒ¨åˆ†ææ‡‚å·²ç»èƒ½å¸®åŠ©æˆ‘ä»¬ç†è§£å¾ˆå¤šé—®é¢˜äº†ã€‚å¦‚æœè¿˜æƒ³çŸ¥é“çš„æ›´å¤šï¼Œå¯ä»¥çœ‹çœ‹é™„å½•3ä¸­çš„ç¬¬1ç¯‡æ–‡ç« ã€‚</p><h2 id="_10-é™„å½•1â€”â€”mesiè·ƒè¿åœºæ™¯è§£æ" tabindex="-1"><a class="header-anchor" href="#_10-é™„å½•1â€”â€”mesiè·ƒè¿åœºæ™¯è§£æ" aria-hidden="true">#</a> 10. é™„å½•1â€”â€”MESIè·ƒè¿åœºæ™¯è§£æ</h2><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024704.png" alt="img" loading="lazy"></p><p>(a)ï¼šé€šè¿‡<code>Writeback</code>æ¶ˆæ¯æŠŠè¢«ä¿®æ”¹è¿‡çš„ç¼“å­˜è¡Œåˆ·æ–°è‡³å†…å­˜ï¼Œä½†æ˜¯CPUçš„Cacheä»ç„¶ä¿ç•™è¯¥æ•°æ®ï¼›</p><p>(b)ï¼šCPUä¿®æ”¹äº†åªä¿å­˜åœ¨å½“å‰Cacheä¸­çš„ç¼“å­˜è¡Œï¼›</p><p>(c)ï¼šCPUæ”¶åˆ°äº†<code>Read Invalidate</code>æ¶ˆæ¯ï¼Œè¯¥æ¶ˆæ¯çš„ç›®æ ‡æ­£æ˜¯å½“å‰å¤„äºMçŠ¶æ€ï¼ˆè¢«ä¿®æ”¹äº†ï¼‰çš„ç¼“å­˜è¡Œã€‚CPUä¸å¾—ä¸ä½¿è‡ªå·±çš„ç¼“å­˜è¡Œå¤±æ•ˆï¼Œå¹¶æŠŠè¯¥ç¼“å­˜è¡Œæ•°æ®æºåŒ<code>Read Response</code>ä»¥åŠ<code>Invalidate Acknowledge</code>æ¶ˆæ¯è¿”å›ï¼›</p><p>(d)ï¼šCPUæ‰§è¡Œäº†ä¸€ä¸ªåŸå­æ“ä½œï¼Œè¯¥æ“ä½œåŒ…å«è¯»å’Œå†™ä¸¤ä¸ªå­æ“ä½œï¼Œå¹¶ä¸”ä¸å¯åˆ†å‰²ã€‚CPUé¦–å…ˆå‘é€<code>Read Invalidate</code>æ¶ˆæ¯ï¼Œæ”¶åˆ°<code>Read Response</code>æ¶ˆæ¯ä¹‹åç«‹åˆ»å¯¹æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œè‡³æ­¤ä¾¿å®Œæˆäº†è¯¥åŸå­æ“ä½œã€‚</p><p>(e)ï¼šå’Œdå¤§è‡´ç›¸åŒã€‚CPUæ‰§è¡Œäº†ä¸€ä¸ªåŸå­æ“ä½œï¼Œè¯¥æ“ä½œåŒ…å«è¯»å’Œå†™ä¸¤ä¸ªå­æ“ä½œï¼Œå¹¶ä¸”ä¸å¯åˆ†å‰²ã€‚CPUé¦–å…ˆå‘é€<code>Invalidate</code>æ¶ˆæ¯ï¼Œæ”¶åˆ°<code>Invalidate Acknowledge</code>æ¶ˆæ¯ä¹‹åç«‹åˆ»å¯¹æ•°æ®è¿›è¡Œæ›´æ–°ï¼Œè‡³æ­¤ä¾¿å®Œæˆäº†è¯¥åŸå­æ“ä½œã€‚</p><p>(f)ï¼šå½“å‰CPUä¿®æ”¹äº†ä¸€ä¸ªç¼“å­˜è¡Œæ•°æ®ï¼Œæ¥ç€å…¶ä»–CPUæ ¸å¿ƒå¯¹å½“å‰CPUçš„è¯¥ç¼“å­˜è¡Œå‘å‡º<code>Read</code>æ¶ˆæ¯ï¼Œå½“å‰CPUå°†è¯¥ç¼“å­˜è¡Œæ•°æ®éš<code>Read Response</code>æ¶ˆæ¯åé¦ˆç»™å…¶ä»–CPUæ ¸å¿ƒã€‚è‡³äºè¯¥è¿‡ç¨‹ä¼šä¸ä¼šæ¶‰åŠåˆ°ç¼“å­˜è¡Œæ•°æ®åˆ·æ–°åˆ°å†…å­˜ï¼Œé‚£å°±ä¸ä¸€å®šäº†ã€‚</p><p>(g)ï¼šå½“å‰CPUç‹¬å äº†ä¸€ä¸ªæœªç»ä¿®æ”¹çš„ç¼“å­˜è¡Œï¼Œå…¶ä»–CPUå¯¹å½“å‰CPUçš„è¯¥ç¼“å­˜è¡Œå‘å‡ºReadæ¶ˆæ¯ï¼Œå½“å‰CPUå°†è¯¥ç¼“å­˜è¡Œéš<code>Read Response</code>æ¶ˆæ¯åé¦ˆç»™å…¶ä»–CPUï¼Œå¹¶å°†ç¼“å­˜è¡Œçš„çŠ¶æ€ç”±<code>Exclusive</code>æ”¹ä¸º<code>Shared</code>ï¼›</p><p>(h)ï¼šå¤šä¸ªCPUå…±äº«æŸä¸ªç¼“å­˜è¡Œï¼Œå…¶ä¸­ä¸€ä¸ªCPUå¯¹å…¶ä»–CPUå‘å‡º<code>Invalidate</code>æ¶ˆæ¯ï¼Œè¯¥CPUæ”¶åˆ°å…¶ä»–æ‰€æœ‰æ‹¥æœ‰è¯¥ç¼“å­˜è¡Œçš„CPUçš„<code>Invalidate Acknowledge</code>æ¶ˆæ¯ä¹‹åï¼Œå°†è¯¥ç¼“å­˜è¡ŒçŠ¶æ€åˆ‡æ¢ä¸º<code>Exclusive</code>ï¼›æˆ–è€…å…¶ä»–CPUè‡ªå·±æ¸…ç©ºäº†è¯¥ç¼“å­˜è¡Œï¼ˆæ¯”å¦‚ä¸ºå…¶ä»–æ•°æ®è…¾å‡ºç©ºé—´ï¼‰å¯¼è‡´è¯¥CPUç‹¬å è¯¥ç¼“å­˜è¡Œï¼ŒåŒæ ·ä¼šå‘ç”Ÿè¿™ç§çŠ¶æ€è½¬æ¢ã€‚</p><p>(i)ï¼šå…¶ä»–CPUå¯¹å½“å‰CPUç‹¬å çš„ä¸€ä¸ªç¼“å­˜è¡Œå‘å‡ºä¸€ä¸ª<code>Read Invalidate</code>æ¶ˆæ¯ï¼Œå½“å‰CPUå°†è¯¥ç¼“å­˜è¡Œè®¾ç½®ä¸º<code>Invalid</code>ï¼Œå¹¶å‘é€<code>Read Response</code>ä»¥åŠ<code>Invalidate Acknowledge</code>åé¦ˆï¼›</p><p>(j)ï¼šCPUå¯¹ä¸åœ¨è‡ªå·±Cacheçš„ä¸€ä¸ªæ•°æ®è¿›è¡Œå†™æ“ä½œï¼Œå› æ­¤å‘å‡º<code>Read Invalidate</code>æ¶ˆæ¯ï¼Œæ”¶åˆ°ä¸€æ¡<code>Read Response</code>ï¼ˆå¯èƒ½æ¥è‡ªå…¶ä»–Cacheï¼Œä¹Ÿå¯èƒ½æ¥è‡ªå†…å­˜ï¼‰ä»¥åŠæ‰€æœ‰æ‹¥æœ‰è¯¥ç¼“å­˜è¡Œçš„CPUçš„<code>Invalidate Acknowledge</code>åé¦ˆï¼ˆå¯èƒ½å‹æ ¹æ²¡æœ‰ï¼‰ä¹‹åï¼Œç¼“å­˜è¡Œè¢«å½“å‰CPUç‹¬å ï¼›</p><p>(k)ï¼šCPUè¯»å–æŸä¸ªè‡ªå·±Cacheä¸­ä¸å­˜åœ¨çš„æ•°æ®ï¼Œäºæ˜¯å‘å‡º<code>Read</code>æ¶ˆæ¯ï¼Œæ”¶åˆ°<code>Read Response</code>ï¼ˆè¯¥æ¶ˆæ¯ä¸€å®šæ¥è‡ªäºå…¶ä»–CPUï¼‰ä¹‹åï¼Œç¼“å­˜è¡Œçš„çŠ¶æ€ç”±<code>Invalid</code>å˜ä¸ºäº†<code>Shared</code>ï¼›</p><p>(l)ï¼šå½“å‰CPUå’Œå…¶ä»–CPUå…±äº«äº†ä¸€ä¸ªç¼“å­˜è¡Œï¼Œçªç„¶æœ‰ä¸€ä¸ªå…¶ä»–CPUå‘å½“å‰CPUå‘æ¥ä¸€æ¡<code>Invalidate</code>æ¶ˆæ¯ï¼Œå½“å‰ç¼“å­˜è¡Œåªèƒ½é»˜é»˜æŠŠè‡ªå·±çš„ç¼“å­˜è¡Œè®¾ç½®ä¸º<code>Invalidate</code>ï¼Œå¹¶å›å¤<code>Invalidate Acknowledge</code>ã€‚</p><h2 id="_11-é™„å½•2â€”â€”mesiåœ¨çº¿ç½‘ç«™ä½¿ç”¨" tabindex="-1"><a class="header-anchor" href="#_11-é™„å½•2â€”â€”mesiåœ¨çº¿ç½‘ç«™ä½¿ç”¨" aria-hidden="true">#</a> 11. é™„å½•2â€”â€”MESIåœ¨çº¿ç½‘ç«™ä½¿ç”¨</h2><p>åœ°å€ï¼š<a href="https://www.scss.tcd.ie/Jeremy.Jones/VivioJS/caches/MESIHelp.htm" target="_blank" rel="noopener noreferrer">https://www.scss.tcd.ie/Jeremy.Jones/VivioJS/caches/MESIHelp.htm<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024712.png" alt="img" loading="lazy"></p><p>è§ä¸Šå›¾ï¼Œç½‘ç«™ä¸»è¦åˆ†ä¸º3éƒ¨åˆ†</p><ol><li>å†…å­˜æ•°æ®</li></ol><p>å†…å­˜ä¸­ä¿å­˜äº†4ä¸ªæ•°æ®ï¼Œåˆå§‹å€¼ä¸º<code>0</code>ï¼Œåœ°å€åˆ†åˆ«ä¸º<code>a0</code>ã€<code>a1</code>ã€<code>a2</code>ã€<code>a3</code>ã€‚</p><ol><li>é«˜é€Ÿç¼“å­˜</li></ol><p>æ˜¾ç¤º CPU ç¼“å­˜çš„å˜é‡æ•°æ®å’Œ MESI åè®®çŠ¶æ€ã€‚è¯¥é«˜é€Ÿç¼“å­˜èƒ½å®¹çº³2ä¸ªç¼“å­˜è¡Œæ•°æ®ï¼Œæ‰€æœ‰ç¼“å­˜è¡Œçš„åˆå§‹çŠ¶æ€ä¸º<code>I</code>ï¼ˆInvalidï¼‰ã€‚</p><ol><li>CPUæ ¸å¿ƒ</li></ol><p>å…±æœ‰3ä¸ª CPUï¼Œæ¯ä¸ª CPU éƒ½æœ‰å„è‡ªçš„ Cacheï¼ŒCPU æ“ä½œåˆ†ä¸ºã€Œè¯»ã€å’Œã€Œå†™ã€ï¼Œè¿™éƒ¨åˆ†æ˜¯æˆ‘ä»¬å¯ä»¥æ‰‹åŠ¨æ“ä½œçš„éƒ¨åˆ†ã€‚</p><p>ä¸¾ä¸ªä¾‹å­ï¼š</p><ol><li>CPU0æ‰§è¡Œ<code>read a0</code>ï¼Œäºæ˜¯é€šè¿‡å„ç§busæ€»çº¿å°†å†…å­˜ä¸­åœ°å€ä¸º<code>a0</code>çš„æ•°æ®è¯»å…¥ç¼“å­˜è¡Œå†…ï¼Œç”±äºç›®å‰åªæœ‰CPU0ç‹¬å è¯¥ç¼“å­˜è¡Œï¼Œæ‰€ä»¥çŠ¶æ€å˜ä¸º<code>Exclusive</code>ï¼›</li><li>CPU1æ‰§è¡Œ<code>read a0</code>ï¼Œåˆé€šè¿‡å„ç§busæ€»çº¿å°†<code>a0</code>çš„æ•°æ®è¯»åˆ°è‡ªå·±çš„ç¼“å­˜è¡Œå†…ï¼Œæ­¤æ—¶CPU0å’ŒCPU1çš„ç¼“å­˜è¡Œéƒ½å˜ä¸º<code>Shared</code>çŠ¶æ€ï¼›</li><li>CPU1æ‰§è¡Œ<code>write a0</code>ï¼Œå°†åœ°å€ä¸º<code>a0</code>çš„æ•°æ®+1åå†™å›å†…å­˜ï¼ŒåŒæ—¶å‘CPU0å‘å‡º<code>Invalidate</code>ä¿¡å·ï¼Œå¯¼è‡´CPU0å°†å…¶ç¼“å­˜è¡Œç½®ä¸º<code>Invalid</code>çŠ¶æ€ï¼›æ­¤æ—¶CPU1ç‹¬å ç¼“å­˜è¡Œï¼Œå› æ­¤ç¼“å­˜è¡Œä¸º<code>Exclusive</code>çŠ¶æ€ï¼›</li><li>CPU1æ‰§è¡Œ<code>read a1</code>ï¼Œç±»ä¼¼ç¬¬1æ­¥ï¼Œé€šè¿‡å„ç§busæ€»çº¿å°†å†…å­˜ä¸­åœ°å€ä¸º<code>a1</code>çš„æ•°æ®è¯»å…¥ç¼“å­˜è¡Œå†…ï¼Œç”±äºç›®å‰åªæœ‰CPU1ç‹¬å è¯¥ç¼“å­˜è¡Œï¼Œæ‰€ä»¥çŠ¶æ€ä¸º<code>Exclusive</code>ï¼›æ­¤æ—¶CPU1çš„Cacheè¢«å æ»¡ï¼›</li><li>æœ€åCPU1æ‰§è¡Œ<code>read a2</code>ï¼Œç”±äºCPU1çš„Cacheå·²ç»è¢«å æ»¡äº†ï¼Œåªèƒ½å¼¹å‡º<code>a0</code>ï¼Œå­˜å…¥<code>a2</code>ï¼Œæ­¤æ—¶<code>a2</code>çŠ¶æ€ä¸º<code>Exclusive</code>ã€‚</li></ol><p><img src="http://qiniu.chanmufeng.com/2022-07-27-024719.gif" alt="img" loading="lazy"></p><h2 id="_12-é™„å½•3â€”â€”å‚è€ƒæ–‡çŒ®" tabindex="-1"><a class="header-anchor" href="#_12-é™„å½•3â€”â€”å‚è€ƒæ–‡çŒ®" aria-hidden="true">#</a> 12. é™„å½•3â€”â€”å‚è€ƒæ–‡çŒ®</h2><p>[1] Paul E. McKenney. Memory Barriers: a Hardware View for Software Hackers.</p><p>[2] <a href="https://blog.csdn.net/xujianqun/article/details/7800813" target="_blank" rel="noopener noreferrer">barrierå’Œsmp_mb<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>[3] <a href="https://www.jianshu.com/p/26868a1ad412" target="_blank" rel="noopener noreferrer">å†…å­˜å±éšœå’Œvolatileè¯­ä¹‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>[4] <a href="https://www.cnblogs.com/mysky007/p/12901776.html" target="_blank" rel="noopener noreferrer">è§£å¯†å†…å­˜å±éšœ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>[5] <a href="https://www.scss.tcd.ie/Jeremy.Jones/VivioJS/caches/MESI.htm" target="_blank" rel="noopener noreferrer">MESIåœ¨çº¿ç½‘ç«™<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>[6] <a href="https://cloud.tencent.com/developer/news/706457" target="_blank" rel="noopener noreferrer">çœ‹æ‡‚è¿™ç¯‡ï¼Œæ‰èƒ½è¯´äº†è§£å¹¶å‘åº•å±‚æŠ€æœ¯<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>[7] <a href="http://www.wowotech.net/kernel_synchronization/why-memory-barrier-2.html" target="_blank" rel="noopener noreferrer">Why Memory Barriersä¸­æ–‡ç¿»è¯‘ï¼ˆä¸‹ï¼‰<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p><p>[8] <a href="https://zhuanlan.zhihu.com/p/43624414" target="_blank" rel="noopener noreferrer">MESIä¸å†…å­˜å±éšœ<span><svg class="external-link-icon" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewbox="0 0 100 100" width="15" height="15"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path><polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg><span class="external-link-icon-sr-only">open in new window</span></span></a></p></div><!----><footer class="page-meta"><!----><div class="meta-item update-time"><span class="label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><span class="info">2022/9/27 06:43:18</span></div><div class="meta-item contributors"><span class="label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="contributor" title="email: zhaoxaolong@163.com">chanmufeng</span><!--]--><!--]--></div></footer><nav class="page-nav"><a href="/posts/concurrency/CPU%E6%B5%81%E6%B0%B4%E7%BA%BF%E4%B8%8E%E6%8C%87%E4%BB%A4%E9%87%8D%E6%8E%92%E5%BA%8F.html" class="nav-link prev" aria-label="CPUæµæ°´çº¿ä¸æŒ‡ä»¤é‡æ’åº"><div class="hint"><span class="arrow left"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="icon iconfont icon-creative"></span>CPUæµæ°´çº¿ä¸æŒ‡ä»¤é‡æ’åº</div></a><!----></nav><div class="giscus-wrapper input-top" style="display:block;"><div style="text-align:center">Loading...</div></div><!----><!--]--></main><!--]--><footer class="footer-wrapper"><div class="footer"><a href='https://beian.miit.gov.cn/'>é²ICPå¤‡20023913å·</a></div><div class="copyright">Copyright Â© 2022 è‰æ²é£</div></footer><!--]--></div><!--]--><!----><!--]--></div>
    <script type="module" src="/assets/app.e63a78e2.js" defer></script>
  </body>
</html>
