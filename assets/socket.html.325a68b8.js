import{_ as s}from"./plugin-vue_export-helper.21dcd24c.js";import{o as n,c as e,e as a}from"./app.df556a34.js";const t={},o=a(`<p>\u73B0\u5728\u6765\u8BE6\u7EC6\u4ECB\u7ECD\u4E00\u4E0B<code>socket()</code>\u8FD9\u4E2A\u7CFB\u7EDF\u8C03\u7528\u3002</p><p>\u5148\u770B\u4E00\u4E9B\u7528\u6CD5\u548C\u53C2\u6570\uFF1A</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/types.h&gt;</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;sys/socket.h&gt;</span></span>

<span class="token keyword">int</span> <span class="token function">socket</span><span class="token punctuation">(</span><span class="token keyword">int</span> domain<span class="token punctuation">,</span> <span class="token keyword">int</span> type<span class="token punctuation">,</span> <span class="token keyword">int</span> protocol<span class="token punctuation">)</span><span class="token punctuation">;</span> 
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>\u53EF\u662F\u8FD9\u4E2A\u51FD\u6570\u7684\u53C2\u6570\u662F\u5E72\u4EC0\u4E48\u7684\u5462\uFF1F\u521A\u5F00\u59CB\u7528\u8FD9\u4E2A\u51FD\u6570\u53EF\u80FD\u4F1A\u4E00\u8138\u61F5\uFF0C\u522B\u6015\uFF0C\u6211\u6162\u6162\u4ECB\u7ECD\u3002</p><p>\u51FD\u6570\u53C2\u6570\u662F\u7528\u6765\u6307\u5B9A\u4F60\u60F3\u8981\u7684socket\u7C7B\u578B\uFF08IPv4\u8FD8\u662FIPv6\uFF0C\u6570\u636E\u6D41\uFF08stream\uFF09\u8FD8\u662F\u6570\u636E\u62A5\uFF08datagram\uFF09\uFF0C<code>TCP</code>\u8FD8\u662F<code>UDP</code>\uFF09\u3002</p><p><code>domain</code>\u53C2\u6570\u6307\u7684\u662F\u534F\u8BAE\u65CF\uFF0C\u4F60\u53EF\u4EE5\u8BBE\u7F6E\u4E3A<code>PF_INET</code>\u6216\u8005<code>PF_INET6</code>\uFF0C\u4E5F\u53EF\u4EE5\u662F\u4E0B\u8868\uFF08\u53EA\u5217\u4E3E\u4E86\u4E00\u90E8\u5206\uFF09\u4E2D\u7684\u67D0\u4E2A\u5E38\u503C\u3002</p><table><thead><tr><th style="text-align:center;">family</th><th style="text-align:center;">\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:center;">AF_INET</td><td style="text-align:center;">IPv4\u534F\u8BAE</td></tr><tr><td style="text-align:center;">AF_INET6</td><td style="text-align:center;">IPv6\u534F\u8BAE</td></tr><tr><td style="text-align:center;">AF_LOCAL</td><td style="text-align:center;">Unix\u57DF\u534F\u8BAE</td></tr><tr><td style="text-align:center;">AF_ROUTE</td><td style="text-align:center;">\u8DEF\u7531\u5957\u63A5\u5B57</td></tr><tr><td style="text-align:center;">AF_KEY</td><td style="text-align:center;">\u5BC6\u94A5\u5957\u63A5\u5B57</td></tr></tbody></table><p><code>type</code>\u8868\u793Asocket\u7684\u7C7B\u578B\uFF0C\u53EF\u4EE5\u662F\u4E0B\u8868\u4E2D\u7684\u67D0\u4E2A\u5E38\u503C\u3002</p><table><thead><tr><th style="text-align:center;">type</th><th style="text-align:center;">\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:center;">SOCK_STREAM</td><td style="text-align:center;">\u5B57\u8282\u6D41socket</td></tr><tr><td style="text-align:center;">SOCK_DGRAM</td><td style="text-align:center;">\u6570\u636E\u62A5socket</td></tr><tr><td style="text-align:center;">SOCK_SEQPACKET</td><td style="text-align:center;">\u6709\u5E8F\u5206\u7EC4socket</td></tr><tr><td style="text-align:center;">SOCK_RAW</td><td style="text-align:center;">\u539F\u59CBsocket</td></tr></tbody></table><p>\u81F3\u4E8E<code>protocol</code>\uFF0C\u4F60\u53EF\u4EE5\u7B80\u5355\u5730\u5C06<code>protocol</code>\u8BBE\u7F6E\u4E3A<code>0</code>\uFF0C\u4F1A\u81EA\u52A8\u9009\u62E9<code>domain</code>\u548C<code>type</code>\u5B57\u6BB5\u7EC4\u5408\u7684\u7CFB\u7EDF\u9ED8\u8BA4\u503C\u3002\u5F53\u7136\u55BD\uFF0C\u5982\u679C\u4F60\u60F3\u4EB2\u529B\u4EB2\u4E3A\uFF0C\u4F60\u4E5F\u53EF\u4EE5\u8C03\u7528 <code>getprotobyname()</code> \u6765\u67E5\u627E\u4F60\u60F3\u8981\u7684\u534F\u8BAE\uFF0C\u53C2\u6570\u53EF\u4EE5\u662F\u201C<code>tcp</code>\u201D\u3001\u201C<code>udp</code>\u201D\u7B49\uFF0C\u8FD8\u53EF\u4EE5\u76F4\u63A5\u4F7F\u7528\u4E0B\u8868\u4E2D\u7684\u5E38\u503C\u3002</p><table><thead><tr><th style="text-align:center;">protocol</th><th style="text-align:center;">\u8BF4\u660E</th></tr></thead><tbody><tr><td style="text-align:center;">IPPROTO_TCP</td><td style="text-align:center;">TCP\u4F20\u8F93\u534F\u8BAE</td></tr><tr><td style="text-align:center;">IPPROTO_UDP</td><td style="text-align:center;">UDP\u4F20\u8F93\u534F\u8BAE</td></tr><tr><td style="text-align:center;">IPPROTO_SCTP</td><td style="text-align:center;">SCTP\u4F20\u8F93\u534F\u8BAE</td></tr></tbody></table><p>\u53EF\u80FD\u4F60\u5DF2\u7ECF\u6CE8\u610F\u5230\u4E86\uFF0C<code>domain</code>\u5B57\u6BB5\u7684\u5019\u9009\u503C\u4E2D\u65E2\u6709<code>AF_INET</code>\u53C8\u6709<code>PF_INET</code>\uFF0C<code>AF_XXX</code> \u548C <code>PF_XXX</code>\u6709\u4EC0\u4E48\u533A\u522B\u5462\uFF1F</p><p><code>AF_</code>\u524D\u7F00\u8868\u793A\u5730\u5740\u65CF\uFF08<code>AF</code>\u8868\u793A<code>Address Family</code>\uFF09\uFF0C<code>PF_</code> \u524D\u7F00\u8868\u793A\u534F\u8BAE\u65CF\uFF08<code>PF</code>\u8868\u793A<code>Protocol Family</code>\uFF09\u3002\u4F60\u53EF\u80FD\u53D1\u73B0\u6709\u4E9B\u8D44\u6599\u7684<code>socket()</code>\u7B2C\u4E00\u4E2A\u53C2\u6570\u4F7F\u7528<code>AF_XXX</code>\uFF0C\u6709\u4E9B\u8D44\u6599\u5374\u4F7F\u7528<code>PF_XXX</code>\uFF0C\u8FD9\u786E\u5B9E\u6709\u70B9\u8BA9\u4EBA\u5934\u75BC\u3002</p><p>\u8FFD\u6839\u6EAF\u6E90\uFF0C\u8FD9\u5176\u5B9E\u662F\u6709\u5386\u53F2\u539F\u56E0\u7684\u3002\u5F88\u4E45\u5F88\u4E45\u4E4B\u524D\uFF0C\u4EBA\u4EEC\u8BBE\u60F3\u5355\u4E2A\u534F\u8BAE\u65CF\u53EF\u4EE5\u652F\u6301\u591A\u4E2A\u5730\u5740\u65CF\uFF0C\u4F46\u662F\u8FD9\u4E2A\u60F3\u6CD5\u5C31\u4ECE\u6765\u6CA1\u6709\u5B9E\u73B0\u8FC7\u3002\u800C\u4E14<code>&lt;sys/socket.h&gt;</code>\u8FD9\u4E2A\u5934\u6587\u4EF6\u4E2D\u4E3A\u67D0\u4E2A\u7ED9\u5B9A\u534F\u8BAE\u5B9A\u4E49\u7684<code>PF_</code>\u503C\u603B\u662F\u548C\u6B64\u534F\u8BAE\u7684<code>AF_</code>\u503C\u76F8\u7B49\uFF0C\u8FD9\u5C31\u76F4\u63A5\u9020\u6210\u4E86<code>AF_</code>\u548C<code>PF_</code>\u6EE5\u7528\u7684\u4E71\u8C61\u3002</p><p>\u76F8\u6BD4<code>PF_XXX</code>\uFF0C\u5F88\u591A\u7A0B\u5E8F\u5458\u66F4\u559C\u6B22\u5C06<code>AF_XXX</code>\u4F5C\u4E3A\u7B2C\u4E00\u4E2A\u53C2\u6570\u4F20\u5165socket\uFF0C\u751A\u81F3\u5305\u62EC\u300AUnix\u7F51\u7EDC\u7F16\u7A0B\u300B\u7684\u4F5C\u8005Stevens\u4E5F\u5728\u4E66\u4E2D\u76F4\u63A5\u7528<code>AF_XXX</code>\u4F5C\u4E3A\u53C2\u6570\uFF08\u8FD9\u5176\u5B9E\u53EA\u662F\u4F5C\u8005\u60F3\u4E0E\u5927\u90E8\u5206\u4EE3\u7801\u4FDD\u6301\u4E00\u81F4\u7F62\u4E86\uFF0C\u7B97\u662F\u4E00\u79CD\u59A5\u534F\uFF09\u3002\u4F46\u5927\u591A\u6570\u4EBA\u505A\u7684\u672A\u5FC5\u5C31\u662F\u5BF9\u7684\u3002</p><p>\u6211\u4EEC\u6700\u63A8\u5D07\u7684\u4E00\u79CD\u505A\u6CD5\u662F\u9075\u5B88POSIX\u89C4\u8303\uFF0C\u5C06<code>socket()</code>\u51FD\u6570\u7684\u7B2C\u4E00\u4E2A\u53C2\u6570\u8BBE\u7F6E\u4E3A<code>PF_</code>\u503C\uFF0C\u800C\u5728<code>struct sockaddr_in</code>\u7ED3\u6784\u4E2D\u4F7F\u7528<code>AF_</code>\u3002</p><p>\u8BF4\u8FD9\u4E48\u591A\u5DF2\u7ECF\u591F\u7528\u4E86\u3002\u7ED3\u5408\u4E4B\u524D\u8BB2\u8FC7\u7684<code>getaddrinfo()</code>\uFF0C\u6211\u4EEC\u9700\u8981\u505A\u7684\u5C31\u662F\u5C06<code>getaddrinfo()</code>\u8C03\u7528\u5F97\u5230\u7ED3\u679C\u76F4\u63A5\u5582\u7ED9<code>socket()</code>\uFF0C\u50CF\u8FD9\u6837\uFF1A</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token keyword">int</span> s<span class="token punctuation">;</span>
<span class="token keyword">struct</span> <span class="token class-name">addrinfo</span> hints<span class="token punctuation">,</span> <span class="token operator">*</span>res<span class="token punctuation">;</span>

<span class="token comment">// do the lookup</span>
<span class="token comment">// [pretend we already filled out the &quot;hints&quot; struct]</span>
<span class="token function">getaddrinfo</span><span class="token punctuation">(</span><span class="token string">&quot;www.example.com&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">,</span> <span class="token operator">&amp;</span>hints<span class="token punctuation">,</span> <span class="token operator">&amp;</span>res<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// again, you should do error-checking on getaddrinfo(), and walk</span>
<span class="token comment">// the &quot;res&quot; linked list looking for valid entries instead of just</span>
<span class="token comment">// assuming the first one is good (like many of these examples do).</span>
<span class="token comment">// See the section on client/server for real examples.</span>

s <span class="token operator">=</span> <span class="token function">socket</span><span class="token punctuation">(</span>res<span class="token operator">-&gt;</span>ai_family<span class="token punctuation">,</span> res<span class="token operator">-&gt;</span>ai_socktype<span class="token punctuation">,</span> res<span class="token operator">-&gt;</span>ai_protocol<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><code>socket()</code>\u51FD\u6570\u5728\u8FD4\u56DE\u6210\u529F\u65F6\u4F1A\u8FD4\u56DE\u4E00\u4E2A\u5957\u63A5\u5B57\u63CF\u8FF0\u7B26\uFF08socket descriptor\uFF09,\u5B83\u662F\u4E00\u4E2A\u975E\u8D1F\u6574\u6570\uFF0C\u5728\u540E\u7EED\u7684\u5176\u4ED6\u51FD\u6570\u8C03\u7528\u4E2D\uFF0C\u6211\u4EEC\u5C06\u4F7F\u7528\u5B83\u6765\u8868\u793A\u8FD9\u4E2Asocket\u3002</p><p>\u5982\u679C\u53D1\u751F\u9519\u8BEF\uFF0C<code>socket()</code>\u4F1A\u8FD4\u56DE<code>-1</code>\uFF0C\u6B64\u65F6<code>errno</code>\u8FD9\u4E2A\u5168\u5C40\u53D8\u91CF\u4F1A\u88AB\u8BBE\u7F6E\u4E3A\u8BE5\u9519\u8BEF\u7684\u503C\u3002</p><blockquote><p>\u53EA\u8981\u4E00\u4E2AUnix\u51FD\u6570\u53D1\u751F\u9519\u8BEF\uFF0CUnix\u7684\u5168\u5C40\u53D8\u91CF<code>errno</code>\u5C31\u4F1A\u88AB\u8BBE\u7F6E\u4E3A\u4E00\u4E2A\u6307\u660E\u8BE5\u9519\u8BEF\u7C7B\u578B\u7684\u67D0\u4E2A\u6B63\u6570\uFF0C\u800C\u51FD\u6570\u672C\u8EAB\u901A\u5E38\u8FD4\u56DE<code>-1</code>\u3002</p><p>\u4E0B\u9762\u5C55\u793A\u4E86<code>&lt;sys/errno.h&gt;</code>\u5934\u6587\u4EF6\u4E2D\u5B9A\u4E49\u7684<code>errno</code>\u7684\u90E8\u5206\u5019\u9009\u503C\uFF1A</p><div class="language-c ext-c line-numbers-mode"><pre class="language-c"><code><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment">/*
 * Error codes
 */</span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">EPERM</span>           <span class="token expression"><span class="token number">1</span>               </span><span class="token comment">/* Operation not permitted */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ENOENT</span>          <span class="token expression"><span class="token number">2</span>               </span><span class="token comment">/* No such file or directory */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ESRCH</span>           <span class="token expression"><span class="token number">3</span>               </span><span class="token comment">/* No such process */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">EINTR</span>           <span class="token expression"><span class="token number">4</span>               </span><span class="token comment">/* Interrupted system call */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">EIO</span>             <span class="token expression"><span class="token number">5</span>               </span><span class="token comment">/* Input/output error */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ENXIO</span>           <span class="token expression"><span class="token number">6</span>               </span><span class="token comment">/* Device not configured */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">E2BIG</span>           <span class="token expression"><span class="token number">7</span>               </span><span class="token comment">/* Argument list too long */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ENOEXEC</span>         <span class="token expression"><span class="token number">8</span>               </span><span class="token comment">/* Exec format error */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">EBADF</span>           <span class="token expression"><span class="token number">9</span>               </span><span class="token comment">/* Bad file descriptor */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ECHILD</span>          <span class="token expression"><span class="token number">10</span>              </span><span class="token comment">/* No child processes */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">EDEADLK</span>         <span class="token expression"><span class="token number">11</span>              </span><span class="token comment">/* Resource deadlock avoided */</span></span>
                                        <span class="token comment">/* 11 was EAGAIN */</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">ENOMEM</span>          <span class="token expression"><span class="token number">12</span>              </span><span class="token comment">/* Cannot allocate memory */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">EACCES</span>          <span class="token expression"><span class="token number">13</span>              </span><span class="token comment">/* Permission denied */</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">EFAULT</span>          <span class="token expression"><span class="token number">14</span>              </span><span class="token comment">/* Bad address */</span></span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote>`,21),c=[o];function p(d,l){return n(),e("div",null,c)}var k=s(t,[["render",p],["__file","socket.html.vue"]]);export{k as default};
